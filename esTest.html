<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Manifold Registry Test</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				max-width: 800px;
				margin: 0 auto;
				padding: 20px;
			}
			.test-section {
				margin: 20px 0;
				padding: 15px;
				border: 1px solid #ccc;
				border-radius: 5px;
			}
			.hidden {
				display: none;
			}
			.item {
				padding: 8px;
				margin: 4px 0;
				background: #f0f0f0;
				border-radius: 3px;
			}
			button {
				padding: 8px 16px;
				margin: 5px;
				background: #007acc;
				color: white;
				border: none;
				border-radius: 3px;
				cursor: pointer;
			}
			button:hover {
				background: #005999;
			}
			input {
				padding: 5px;
				margin: 5px;
				border: 1px solid #ccc;
				border-radius: 3px;
			}
		</style>
	</head>
	<body>
		<h1>Registry Test - data-scope</h1>

		<div class="test-section">
			<h2>Element Registry Test</h2>
			<p>Testing data-scope prop binding and logging</p>

			<div id="test-element" data-scope="@user, @counter">
				Test element with scoped props
			</div>

			<button onclick="logProps()">Log Props</button>
			<button onclick="updateProps()">Update Props</button>
			<button onclick="logPropsAgain()">Log Props Again</button>
		</div>

		<!-- Import Manifold -->
		<script type="module">
			import { State, RegEl } from "./dist/manifold.es.js";

			// Initialize test states
			window.userState = new State({
				name: "John Doe",
				age: 25,
			});
			window.counterState = new State(0);

			// Register states globally
			State.register("user", window.userState);
			State.register("counter", window.counterState);

			// Register the test element
			let testRegEl;
			document.addEventListener("DOMContentLoaded", () => {
				const testElement = document.getElementById("test-element");
				testRegEl = RegEl.register(testElement);
				console.log("Element registered:", testRegEl);
			});

			// Test functions
			window.logProps = () => {
				console.log("=== Logging Props ===");
				console.log("RegEl props:", testRegEl.props);

				Object.entries(testRegEl.props).forEach(([key, state]) => {
					console.log(`${key}:`, state.value);
				});
			};

			window.updateProps = () => {
				console.log("=== Updating Props ===");
				window.userState.value = {
					name: "Jane Smith",
					age: 30,
				};
				window.counterState.value = 42;
				console.log("Props updated!");
			};

			window.logPropsAgain = () => {
				console.log("=== Logging Props Again ===");
				console.log("RegEl props:", testRegEl.props);

				Object.entries(testRegEl.props).forEach(([key, state]) => {
					console.log(`${key}:`, state.value);
				});
			};
		</script>
	</body>
</html>
