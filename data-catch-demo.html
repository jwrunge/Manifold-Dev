<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>data-catch vs data-else Demo</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				margin: 20px;
				max-width: 800px;
			}
			.demo-section {
				border: 2px solid #ccc;
				margin: 20px 0;
				padding: 20px;
				border-radius: 8px;
			}
			.conditional {
				border-color: #4caf50;
				background-color: #f8fff8;
			}
			.async {
				border-color: #2196f3;
				background-color: #f8f9ff;
			}
			.success {
				color: #4caf50;
				font-weight: bold;
			}
			.error {
				color: #f44336;
				font-weight: bold;
			}
			.loading {
				color: #ff9800;
				font-style: italic;
			}
			button {
				padding: 10px 20px;
				margin: 5px;
				background: #2196f3;
				color: white;
				border: none;
				cursor: pointer;
				border-radius: 4px;
			}
			button:hover {
				background: #1976d2;
			}
			.code {
				background: #f0f0f0;
				padding: 10px;
				border-radius: 4px;
				font-family: monospace;
				margin: 10px 0;
			}
		</style>
	</head>
	<body>
		<h1>data-catch vs data-else Demo</h1>
		<p>
			This page demonstrates the clear separation between:
			<br />
			‚Ä¢ <strong>data-else</strong>: Used for conditional if/else logic
			<br />
			‚Ä¢ <strong>data-catch</strong>: Used for async promise error handling
		</p>

		<div class="demo-section conditional">
			<h2>üîÑ Conditional Logic: data-else</h2>
			<p>
				Traditional if/else conditional display using
				<code>data-else=""</code> (empty value)
			</p>

			<div class="code">
				&lt;div data-if="@isLoggedIn"&gt;Welcome back!&lt;/div&gt;<br />
				&lt;div data-else=""&gt;Please log in&lt;/div&gt;
			</div>

			<button data-bind="onclick: () => window.toggleLogin()">
				Toggle Login Status
			</button>

			<div data-if="@isLoggedIn" class="success" style="margin: 10px 0">
				‚úÖ Welcome back! You are logged in.
			</div>

			<div data-else="" class="error" style="margin: 10px 0">
				‚ùå Please log in to continue.
			</div>

			<p>
				<strong>Current status:</strong>
				<span
					data-bind="textContent: @isLoggedIn ? 'Logged In' : 'Logged Out'"
				></span>
			</p>
		</div>

		<div class="demo-section async">
			<h2>‚ö° Async Error Handling: data-catch</h2>
			<p>
				Promise error handling using
				<code>data-catch="errorVariable"</code> (with variable name)
			</p>

			<div class="code">
				&lt;div data-await="@apiCall" data-then="response"
				data-catch="apiError"&gt;Loading...&lt;/div&gt;<br />
				&lt;div data-then="response"&gt;Success:
				${response}&lt;/div&gt;<br />
				&lt;div data-catch="apiError"&gt;Error: ${apiError}&lt;/div&gt;
			</div>

			<button data-bind="onclick: () => window.testSuccess()">
				Test Success
			</button>
			<button data-bind="onclick: () => window.testError()">
				Test Error
			</button>

			<!-- Loading state -->
			<div
				data-await="@demoPromise"
				data-then="demoResult"
				data-catch="demoError"
				class="loading"
				style="margin: 10px 0"
			>
				‚è≥ Loading API call...
			</div>

			<!-- Success state -->
			<div
				data-then="demoResult"
				class="success"
				style="margin: 10px 0; display: none"
			>
				‚úÖ API Success: ${demoResult}
			</div>

			<!-- Error state -->
			<div
				data-catch="demoError"
				class="error"
				style="margin: 10px 0; display: none"
			>
				‚ùå API Error: ${demoError.message}
			</div>
		</div>

		<div class="demo-section">
			<h2>üìã Key Differences</h2>
			<table style="width: 100%; border-collapse: collapse">
				<tr style="background: #f5f5f5">
					<th
						style="
							border: 1px solid #ccc;
							padding: 10px;
							text-align: left;
						"
					>
						Attribute
					</th>
					<th
						style="
							border: 1px solid #ccc;
							padding: 10px;
							text-align: left;
						"
					>
						Purpose
					</th>
					<th
						style="
							border: 1px solid #ccc;
							padding: 10px;
							text-align: left;
						"
					>
						Value
					</th>
					<th
						style="
							border: 1px solid #ccc;
							padding: 10px;
							text-align: left;
						"
					>
						Usage
					</th>
				</tr>
				<tr>
					<td style="border: 1px solid #ccc; padding: 10px">
						<code>data-else</code>
					</td>
					<td style="border: 1px solid #ccc; padding: 10px">
						Conditional logic
					</td>
					<td style="border: 1px solid #ccc; padding: 10px">
						Empty string <code>""</code>
					</td>
					<td style="border: 1px solid #ccc; padding: 10px">
						Show when previous if/elseif conditions are false
					</td>
				</tr>
				<tr>
					<td style="border: 1px solid #ccc; padding: 10px">
						<code>data-catch</code>
					</td>
					<td style="border: 1px solid #ccc; padding: 10px">
						Async error handling
					</td>
					<td style="border: 1px solid #ccc; padding: 10px">
						Variable name <code>"errorVar"</code>
					</td>
					<td style="border: 1px solid #ccc; padding: 10px">
						Show when promise rejects, error stored in variable
					</td>
				</tr>
			</table>
		</div>

		<script type="module">
			import { State } from "./src/State.js";
			import { RegEl } from "./src/registry.js";

			// Create states
			const isLoggedIn = new State(true);
			const demoPromise = new State();

			// Register states globally
			State.register("isLoggedIn", isLoggedIn);
			State.register("demoPromise", demoPromise);

			// Toggle function for conditional demo
			window.toggleLogin = () => {
				console.log(
					"üîÑ Toggling login from",
					isLoggedIn.value,
					"to",
					!isLoggedIn.value
				);
				isLoggedIn.value = !isLoggedIn.value;
			};

			// Success test for async demo
			window.testSuccess = () => {
				console.log("üöÄ Testing success case");
				const rawPromise = new Promise((resolve) => {
					setTimeout(() => {
						console.log("‚úÖ Promise resolved successfully");
						resolve("Data loaded successfully!");
					}, 1500);
				});

				window.currentPromise = rawPromise;
				demoPromise.value = rawPromise;
			};

			// Error test for async demo
			window.testError = () => {
				console.log("üöÄ Testing error case");
				const rawPromise = new Promise((resolve, reject) => {
					setTimeout(() => {
						console.log("‚ùå Promise rejected with error");
						reject(new Error("API call failed"));
					}, 1500);
				});

				window.currentPromise = rawPromise;
				demoPromise.value = rawPromise;
			};

			// Register all elements after page load
			document.addEventListener("DOMContentLoaded", () => {
				console.log("üìã Registering all Manifold elements...");
				document
					.querySelectorAll(
						"[data-bind], [data-if], [data-else], [data-await], [data-then], [data-catch]"
					)
					.forEach((element) => {
						console.log("Registering element:", element);
						RegEl.register(element);
					});
				console.log("‚úÖ All elements registered");

				// Debug: Check if test functions are available
				console.log("üîç Functions available:");
				console.log("toggleLogin:", typeof window.toggleLogin);
				console.log("testSuccess:", typeof window.testSuccess);
				console.log("testError:", typeof window.testError);
			});
		</script>
	</body>
</html>
