<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Manifold - Fixed State Registration</title>
		<style>
			body {
				font-family: system-ui, sans-serif;
				max-width: 800px;
				margin: 0 auto;
				padding: 2rem;
			}
			.test {
				margin: 1rem 0;
				padding: 1rem;
				border: 1px solid #ddd;
				border-radius: 4px;
			}
			.pass {
				border-color: #28a745;
				background: #d4edda;
			}
			button {
				padding: 8px 16px;
				margin: 4px;
				background: #007acc;
				color: white;
				border: none;
				border-radius: 4px;
				cursor: pointer;
			}
		</style>
	</head>
	<body>
		<h1>ðŸ”§ Manifold - Fixed State Registration</h1>

		<div class="test">
			<h3>Test: Named States + Manual Registration</h3>
			<div data-mf-register id="test-target">
				<p>User: ${user.name}</p>
				<p>Age: ${user.age}</p>
				<p>Counter: ${counter}</p>
				<button onclick="${() => counter++}">Increment</button>
			</div>
			<button id="register-test">Register Element</button>
			<button id="update-states">Update States</button>
		</div>

		<script type="module">
			import { state, register } from "./src/index.js";

			// Create states with explicit names - this should fix the issue
			window.user = state({ name: "John Doe", age: 25 }, "user");
			window.counter = state(0, "counter");

			console.log("States created with names:");
			console.log("User state name:", window.user._name);
			console.log("Counter state name:", window.counter._name);

			document.getElementById("register-test").onclick = () => {
				const target = document.getElementById("test-target");
				console.log("Registering element:", target);

				try {
					const regEl = register(target);
					console.log("Registration successful:", regEl);
					console.log("RegEl props:", regEl._props);

					// Check if states were properly connected
					if (regEl._props.user) {
						console.log(
							"âœ… user state connected:",
							regEl._props.user._name
						);
					}
					if (regEl._props.counter) {
						console.log(
							"âœ… counter state connected:",
							regEl._props.counter._name
						);
					}

					document.querySelector(".test").classList.add("pass");
				} catch (error) {
					console.error("Registration failed:", error);
				}
			};

			document.getElementById("update-states").onclick = () => {
				console.log("Updating states...");
				window.user.value = {
					...window.user.value,
					name: "Updated User",
					age: 30,
				};
				window.counter.value += 5;
				console.log("States updated");
			};

			console.log("ðŸ”§ Fixed registration test ready");
		</script>
	</body>
</html>
