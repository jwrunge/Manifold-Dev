<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Manifold Template Interpolation Test</title>
		<style>
			body {
				font-family: system-ui, -apple-system, sans-serif;
				max-width: 800px;
				margin: 0 auto;
				padding: 2rem;
				line-height: 1.6;
			}

			.section {
				background: #f5f5f5;
				padding: 1rem;
				margin: 1rem 0;
				border-radius: 4px;
				border-left: 4px solid #007acc;
			}

			.section h3 {
				margin-top: 0;
				color: #007acc;
			}

			button {
				background: #007acc;
				color: white;
				border: none;
				padding: 0.5rem 1rem;
				border-radius: 4px;
				cursor: pointer;
				margin: 0.5rem 0.5rem 0.5rem 0;
			}

			button:hover {
				background: #005a9e;
			}

			.product {
				background: white;
				padding: 1rem;
				margin: 0.5rem 0;
				border-radius: 4px;
				border: 1px solid #ddd;
			}

			.hidden {
				display: none;
			}

			input {
				padding: 0.5rem;
				border: 1px solid #ddd;
				border-radius: 4px;
				margin: 0.5rem;
			}
		</style>
	</head>
	<body>
		<h1>Manifold Template Interpolation Test</h1>
		<p>Testing ${} interpolation with direct elements (no template tags)</p>

		<div class="section">
			<h3>Basic Interpolation</h3>
			<div data-if="@user.isLoggedIn">
				Welcome back, ${user.name}! You have ${user.points} points.
			</div>
			<div data-if="!@user.isLoggedIn">
				Please log in to see your profile.
			</div>
			<button onclick="toggleLogin()">Toggle Login</button>
			<button onclick="updateUser()">Update User Info</button>
		</div>

		<div class="section">
			<h3>Counter with Interpolation</h3>
			<div data-if="@counter.value >= 0">
				Current count: ${counter.value} (${counter.message})
			</div>
			<div data-if="@counter.value < 0">
				Negative count: ${counter.value} - ${counter.message}
			</div>
			<button onclick="increment()">+1</button>
			<button onclick="decrement()">-1</button>
			<button onclick="reset()">Reset</button>
		</div>

		<div class="section">
			<h3>Simple List Rendering</h3>
			<div data-if="@items.length > 0">
				<h4>Items (${items.length} total):</h4>
				<div data-each="@items">
					<div class="product">
						Item #${key}: ${value.name} - $${value.price}
						<br /><small>Category: ${value.category}</small>
					</div>
				</div>
			</div>
			<div data-if="@items.length === 0">
				No items available. Add some items to see them here.
			</div>
			<button onclick="addItem()">Add Item</button>
			<button onclick="clearItems()">Clear All</button>
		</div>

		<div class="section">
			<h3>Conditional Messages</h3>
			<div data-if="@status.level === 'success'">
				✅ ${status.message} (Level: ${status.level})
			</div>
			<div data-if="@status.level === 'warning'">
				⚠️ ${status.message} (Level: ${status.level})
			</div>
			<div data-if="@status.level === 'error'">
				❌ ${status.message} (Level: ${status.level})
			</div>
			<button onclick="setSuccess()">Success</button>
			<button onclick="setWarning()">Warning</button>
			<button onclick="setError()">Error</button>
		</div>

		<script type="module">
			import Manifold from "./src/index.js";

			console.log("Manifold loaded:", Manifold);

			// Create state with nested properties
			const appState = Manifold.$.create({
				user: {
					isLoggedIn: false,
					name: "John Doe",
					points: 1250,
				},
				counter: {
					value: 0,
					message: "ready",
				},
				items: [
					{ name: "Laptop", price: 999.99, category: "Electronics" },
					{ name: "Book", price: 24.99, category: "Education" },
				],
				status: {
					level: "success",
					message: "All systems operational",
				},
			});

			// Make state accessible globally
			window.appState = appState;

			// Button handlers
			window.toggleLogin = function () {
				appState.user.value = {
					...appState.user.value,
					isLoggedIn: !appState.user.value.isLoggedIn,
				};
				console.log("Login status:", appState.user.value.isLoggedIn);
			};

			window.updateUser = function () {
				const names = [
					"John Doe",
					"Jane Smith",
					"Bob Wilson",
					"Alice Brown",
				];
				const randomName =
					names[Math.floor(Math.random() * names.length)];
				const randomPoints = Math.floor(Math.random() * 5000);

				appState.user.value = {
					...appState.user.value,
					name: randomName,
					points: randomPoints,
				};
				console.log("User updated:", appState.user.value);
			};

			window.increment = function () {
				appState.counter.value = {
					value: appState.counter.value.value + 1,
					message: "increasing",
				};
				console.log("Counter:", appState.counter.value);
			};

			window.decrement = function () {
				appState.counter.value = {
					value: appState.counter.value.value - 1,
					message: "decreasing",
				};
				console.log("Counter:", appState.counter.value);
			};

			window.reset = function () {
				appState.counter.value = {
					value: 0,
					message: "reset",
				};
				console.log("Counter reset");
			};

			window.addItem = function () {
				const items = [...appState.items.value];
				const categories = ["Electronics", "Books", "Clothing", "Home"];
				const names = ["Widget", "Gadget", "Tool", "Device"];

				items.push({
					name:
						names[Math.floor(Math.random() * names.length)] +
						" " +
						(items.length + 1),
					price: Math.round(Math.random() * 200 + 10),
					category:
						categories[
							Math.floor(Math.random() * categories.length)
						],
				});

				appState.items.value = items;
				console.log("Items:", items);
			};

			window.clearItems = function () {
				appState.items.value = [];
				console.log("Items cleared");
			};

			window.setSuccess = function () {
				appState.status.value = {
					level: "success",
					message: "Operation completed successfully",
				};
			};

			window.setWarning = function () {
				appState.status.value = {
					level: "warning",
					message: "Please check your input",
				};
			};

			window.setError = function () {
				appState.status.value = {
					level: "error",
					message: "Something went wrong",
				};
			};

			// Initialize Manifold
			console.log("Initializing Manifold...");
			try {
				Manifold.init();
				console.log("Manifold initialized successfully");
				console.log("Initial state:", {
					user: appState.user.value,
					counter: appState.counter.value,
					items: appState.items.value.length + " items",
					status: appState.status.value,
				});
			} catch (error) {
				console.error("Error initializing Manifold:", error);
			}
		</script>
	</body>
</html>
