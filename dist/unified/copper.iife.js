var Cu=function(){"use strict";function t(t){let e=0;const n=(new TextEncoder).encode(t);for(let t of n)e=(e<<5)-e+t,e&=65535;return e}let e={el:{str:"CU-STR",def:"CU-DEFAULT"},attr:{bind:"cu-bind",value:"cu-value",html:"cu-html",if:"cu-if",elseif:"cu-else-if",else:"cu-else",templ:"cu-template"},trans:{all:"cu-trans",in:"cu-in",out:"cu-out"},hash:function e(n){if(!n)return 0;if("object"==typeof n){let t;if(n instanceof Map)t=n.entries();else{if(!(n instanceof Set))return Date.now();t=Array.from(n)}return e(JSON.stringify(t))}return t("string"==typeof n?n:n.toString())}};class n{name;value=void 0;#t;#e=new Map;#n=[];#r=[];#s=void 0;#a;static storeMap=new Map;constructor(t){return this.modify(t),this}addDep(t){this.#n?.push(t)}addSub(t,e){this.#e.set(t,e),e?.(this.value)}async#i(){let t=this.#r?.map((t=>t.value));if(t?.length){try{this.value=await(this.#t?.(t||[],this?.value))||void 0,this.#a?.(this.value)}catch(t){console.error("No value returned from updater().",t)}this.#o()}}modify(t){this.#r=t?.upstream;for(let t of this.#r||[])t.addDep(this);t?.name&&(this.name=t?.name,n.storeMap.set(t?.name,this)),this.value=t?.value,this.#a=t?.onChange,this.#t=t?.updater,this.#i()}async update(t){this.value="function"==typeof t?t?.(this.value):t,this.#o()}#o(){let t=e.hash(this.value);t!==this.#s&&(this.#s=t,this.#a?.(this.value),this.#u())}#u(){this.#n=(this.#n||[]).filter((t=>void 0!==t));for(let t of this.#n||[])t.#i();this.#e.forEach(((t,e)=>{e?t?.(this.value,e):this.#e.delete(e)}))}}function r(t){return n.storeMap.get(t)}function s(t){let e={},n=t?.split(" ")||[];for(let t=0;t<n.length;t++){const r=n[t],s=r.split(":");t?"sync"!==s?.[0]?e.propagations?e.egressFunc=window[r]:e.ingressFunc=window[r]:e.propagations=s[1]?.split("|"):(e.storeName=s[0],e.bindings=s[1]?.split("|"))}return e}function a(t){t=t?.split(/[\.\[]/g)[0];let e=r(t||"");return e||(e=window[t]),e}function i(t,e,n,r,s,a,i){if(e){const o=e=>{e=function(t,e){let n=t;const r=e?.replace(/[\]?]/g,"").split(/[\.\[]/g).slice(1)||[];if(!r?.length)return n;for(let t of r)try{n=n instanceof Map?n.get(t):n[Array.isArray(n)||n instanceof Set?parseInt(t):t]}catch(t){return}return n}(e,n),e=r?.({val:e,el:t})??e,s||"style"!==a||(s="style"),s&&("attr"===a?t.setAttribute(s,e):"style"===a?t.style[s]=e:t[s]=e),i?.({val:e,el:t})};e.addSub(t,o)}}function o(t){for(let n of[e.attr.if,e.attr.elseif]){const e=t?.getAttribute(n)||t?.getAttribute(`data-${n}`);if(e){const{storeName:t,ingressFunc:r}=s(e);return{asType:n,storeName:t,ingressFunc:r}}}if(t?.hasAttribute(e.attr.else))return{asType:e.attr.else}}const u={Store:n,init:function(t){const n=[`[${e.attr.if}]`,`[data-${e.attr.if}]`,e.el.str,`[${e.attr.bind}]`,`[data-${e.attr.bind}]`];(t||document.body)?.querySelectorAll(n.join(",")).forEach((t=>{t.hasAttribute(e.attr.if)||t.hasAttribute(`data-${e.attr.if}`)?function(t){for(;t;){const{asType:e,storeName:n,ingressFunc:r}=o(t)||{};if(e){if("TEMPLATE"===t.tagName){const e=t.innerHTML,n=t.getAttribute("cu-promote")||t.getAttribute("data-cu-promote")||"div";let r=document.createElement(n);r.innerHTML=e;for(const e of t.attributes)r.setAttribute(e.name,e.value);t.replaceWith(r),t=r}const e=({val:t,el:e})=>{e.style.display=t?"":"none"};i(t,a(n),n||"",r,null,null,e),t=t.nextElementSibling}else t=t.nextElementSibling}}(t):t.tagName==e.el.str.toUpperCase()?function(t){const n=t?.getAttribute(e.attr.value),{storeName:r,ingressFunc:o}=s(n);i(t,a(r),r||"",o,null!==t.getAttribute(e.attr.html)?"innerHTML":"innerText")}(t):(t.hasAttribute(e.attr.bind)||t.hasAttribute(`data-${e.attr.bind}`))&&function(t){t?.getAttribute(e.attr.bind)?.split(";").forEach((e=>{const{storeName:n,bindings:r,ingressFunc:o,propagations:u,egressFunc:l}=s(e);for(let e of r||[null]){let r="";for(let t of["attr","style"])e?.includes(`${t}-`)&&(r=t,e=e.replace(`${t}-`,""));const s=a(n);i(t,s,n||"",o,e,r);for(let n of u||[]){const a=n=>{let a="attr"===r?n.currentTarget?.getAttribute(e):"style"===r?n.currentTarget?.style.getPropertyValue(e):n.currentTarget[e];a=l?.({val:a,el:t})||a,s?.update(a)};t.removeEventListener(n,a),t.addEventListener(n,a)}}}))}(t)}))},get:r,rm:function(t){n.storeMap.delete(t)},val:function(t,e){if(!e)return r(t)?.value;r(t)?.update(e)}};return u}();
