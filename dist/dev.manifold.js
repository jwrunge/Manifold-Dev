window.MFLD||(window.MFLD={st:new Map,mut:new Map,$st:new Proxy(c,{get:(t,e)=>"string"==typeof e?t(e)?.value:void 0,set:(t,e,s)=>{if("string"==typeof e){let n=e.split(/[\.\[\]\?]{1,}/g).map((t=>parseFloat(t.trim())||t.trim())),i=t(n[0]),o=i.value;for(let t of n.slice(1)||[])o=o[t];o=s,i.update(o)}return!0}}),$fn:{},comp:{}});let{$fn:t,$st:e}=MFLD,s=[],n=new Set,i=0,o=[],l=t=>{"function"==typeof t?s.push(t):n.add(t),i||(i=requestAnimationFrame(r))};function r(l,a=0){if(a>100)return void console.error("MFLD: Recursion limit reached - check for circular refrences.");i=0;for(let t of s)t();let f=new Set;for(let s of n){let i=!1;for(let t of s.t)if(n.has(t)){i=!0;break}if(i)f.add(s);else{let n=s.i?.({$cur:s.value,$st:e,$fn:t,$el:s.l?.o});s.update(void 0===n?s.value:n)}}s=[],n.clear(),f.size?(n=f,r(0,a+1)):(n.size&&r(0,a+1),o.forEach((t=>t())),o=[])}function a(t){if(!t||!isNaN(t)||!0===t)return t;if(t instanceof Map||t instanceof Set)return a(Array.from(t.entries()||t));let e=0;for(let s of(new TextEncoder).encode(t?.toString()||""))e=(e<<5)-e+s;return e}class f{i;u=new Set;h;t=new Set;p=new Set;l;name;value;constructor(t,e){this.name=t,MFLD.st.set(t,this),this.l=e?.scope,this.value="function"!=typeof e?.value?e?.value:void 0,this.$(e)}$(t){return t?.dependencyList?.map((t=>{let e=c(t);return this.t.add(e),e.p.add(this),e})),this.value=t?.value,this.i=t?.updater,this.m(),this}sub(t,e=!0){this.u.add(t),e&&t(this.value)}update(t){setTimeout((()=>{let e="function"==typeof t?t(this.value):t,s=a(e);if(s!==this.h){this.value=e,this.h=s;for(let t of this.p)t.m();for(let t of Array.from(this.u))t(this.value)}return this.value}),0)}m(){l(this)}}function c(t,e){let s=MFLD.st.get(t);return e?s?s.$(e):new f(t,e):s||new f(t,e)}let u="data-mf-",h=/, {0,}/g,d=()=>`${Date.now()}.${Math.floor(1e5*Math.random())}`,p=(t,e)=>{let s=t.profiles?.[e.M("override")||""],n={...t,...s};for(let t of e.o?.attributes||[])for(let e of["fetch","trans"]){let s=t.name;if(s.startsWith(`${u}${e}_`))try{let i=s.split("_")[2],o=t.value;o?.match(/\{|\[/)?o=JSON.parse(o):parseInt(o||"")&&(o=parseInt(o)),Array.isArray(o)&&(o=o.map((t=>parseInt(t)||t))),n?.[e]?.[i]&&(n[e][i]=o)}catch(t){console.error(t)}}return n},$=(t,e="$val",s="$key")=>{try{let[n,i]=t?.split(/\s{1,}as\s{1,}/)||[t,"value"],o=n?.match(/^\s{0,}(function)?\(.{0,}\)(=>)?\s{0,}/)?`(${n})()`:n,l=`let {$cur, $el, $st, $fn, ${e}, ${s}, $body} = ops;return ${o}`,r=i?.split?.(h)?.map?.((t=>t.trim()))||["value"]||[],a=Array.from(new Set([...n?.matchAll(/\$st\.(\w{1,})/g)].map((t=>t[1]))));return o?{func:new Function("ops",l),as:r,dependencyList:a}:{}}catch(t){return console.error(t),{}}};function m(t,e,s){e?.preventDefault?.();let n=t?.M("pushstate"),i=s;switch(n){case"":break;case void 0:return;default:i=`#${n}`}history.pushState(null,"",i)}let w=new Map,y=(t,e,s,n,i)=>{(w.get(t)||new M("TRANSITION "+e,{element:t,ops:s}))?._(e,n,i)};class M{o;L=new Map;v=new Set;T;constructor(t,e){let s;return s=e.element?e.element:e.query?(e.parent||document).querySelector(e.query):document.createElement(e.create||"TEMPLATE"),this.o=s,w.get(this.o)?.F(!1),w.set(this.o,this),this.S(["_mfld",...e.classes||[]]),e.A&&e.A.ref.A(s,e.A.mode,!1),this.T=e.ops,this}M(t,e){e&&this.o?.setAttribute(`${u}${t}`,e);let s=this.o?.getAttribute(`${u}${t}`);return s??null}S(t,e=!1){for(let s of t)this.o?.classList[e?"remove":"add"]?.(s)}D(t,e=!0){return this.o?.["querySelector".concat(e?"All":"")](t)}k(s,n){let i=()=>n({$el:this.o,$st:e,$fn:t});this.o?.addEventListener(s,i),this.L?.set(s,i)}C(t){return t&&this.v?.add(t),t}N(s,n,i){let o=d();this.M("cstore",o),this.C(s);let l=c(o,{updater:()=>s?.({$el:this.o,$st:e,$fn:t}),dependencyList:n,scope:this});return i&&(this.C(i),l.sub(i)),l}A(t,e="append",s=!0){let n=s?t.cloneNode(!0):t;return this.o?.[e]?.(n),n}I(t){this.o?.replaceWith(t.o),this.F()}O(t=[]){if("TEMPLATE"==this.o?.tagName)return this.S(t),this;let e=new M("As TeMPL",{classes:t,ops:this.T,A:{ref:this}});return e.o.content?.append(this.o.cloneNode(!0)),this.I(e),e}P(){let t=this.o,e=getComputedStyle(t),s=t.getBoundingClientRect();return{w:`calc(${t.clientWidth}px - ${e.paddingLeft} - ${e.paddingRight})`,left:`calc(${s.left}px + ${window.scrollX}px)`,top:`calc(${s.top}px + ${window.scrollY}px)`}}_(t,e,s){l((()=>{"out"==t&&this.F(),s?.()}))}F(t=!0){this.L?.forEach(((t,e)=>{this.o?.removeEventListener(e,t)})),this.v?.forEach((t=>{this.v?.delete(t)})),this.D("._mfld",!0)?.forEach((t=>{w.get(t)?.F()})),this.v=this.L=null,t&&this.o.remove(),w.delete(this.o)}}let _=(t,e,s,n,i,o,l)=>{let r=e=>L(e,i,s,n,t,!0,o,l);"$mount"===e?r():t.k(e,r)},L=async(s,n,i,o,l,r,a,f)=>{s?.preventDefault(),s?.stopPropagation(),n||(n=s?.target?.method||"get");let c=i.fetch?.externals?.find((t=>"$origin"===t.domain&&(o.startsWith(location.origin)||!o.match(/^(https?):\/\//))||o.startsWith(t.domain)));c||(c=o.startsWith(location.origin)?{domain:"$origin",script:"selected",style:"selected"}:void 0);let u=a?a({$el:l,$st:e,$fn:t}):void 0,h="$form"===u?new FormData(l.o):u,d=await fetch(o,{...i.fetch?.request||{},headers:{...i.fetch?.request?.headers,MFLD:"true"},method:n,body:"$form"===u||"string"==typeof h?h:JSON.stringify(h)}).catch((t=>{i.fetch?.err?.(t)})),p=d?.status;if(p&&!1===i.fetch?.onCode?.(p,d))return;let w=await(d?.[i.fetch?.resType||"text"]());for(let t of["append","prepend","inner","outer"]){let e=l.M(t);if(null==e)continue;let[s,n]=e.split("->").map((t=>t.trim())),o=(new DOMParser).parseFromString(w,"text/html"),r=new M("FETCH IN EL",{parent:o,query:s||"body",ops:i}),[a,u]=["style","script"].map((t=>Array.from(("all"==c?.[t]?o:r.o)?.querySelectorAll(t))));if("all"===c?.style)a.forEach((t=>r?.A(t,"append",!1)));else a.forEach((t=>t.parentNode?.removeChild(t)));for(let t of u)t.parentNode?.removeChild(t);r&&r._("in",null,(()=>{f?.(l);for(let t of u){let e=document.createElement("script");e.textContent=t.textContent,l?.o?.append(e)}})),(n?new M("FETCH OUTEL",{query:n,ops:i}):l)._("out")}let y=l.M("resolve"),_=$(y||"")?.func;_?.({$el:l,$st:e,$fn:t,$body:w}),r&&m(l,s,o)},b={},g=["bind","sync","templ","if","elseif","else","each","get","head","post","put","delete","patch","promote"];window.addEventListener("popstate",(()=>{location.reload()}));let v=(s,n=!1)=>{if(!s||s?.nodeType==Node.TEXT_NODE)return;let i=":not(._mfld)",o=s.querySelectorAll(`[${u}${g.join(`]${i},[${u}`)}]${i}`);for(let i of(n?[...o]:[s,...o]).map((t=>((t,e)=>w.get(t)||new M("REGISTER ELEMENT FN",{element:t,ops:e}))(t,b)))){let s=p(structuredClone(b),i);for(let n of g)if(null!==i.M(n))if("promote"!=n)for(let o of i.M(n)?.split(";;")||[""]){let l=!!/get|head|post|put|delete|patch/.test(n),r=o?.split(/\s*->\s*/g),a=l&&r.pop()||"",f=l||"sync"==n?r.shift()?.match(/[^\(\)]{1,}/g)?.pop()?.split(h)?.map((t=>t.trim()))||[]:null,c=r?.[0]||"",{func:d,as:p,dependencyList:w}=$(c);if(i.C(d),f)for(let o of f)if("sync"==n){let s=s=>{d?.({$el:i.o,$st:e,$fn:t}),m(i,s)};"$mount"===o?s():i.k(o,s)}else _(i,o,s,a,n.replace(u,""),d);else"bind"==n&&i.N(d,w)}else{let[t,e,n,o]="A"==i.o.tagName?["get",i.o.href,void 0,"click"]:[i.o.method?.toLowerCase(),i.o.action,()=>"$form","submit"];e&&_(i,o,s,e,t,n,(t=>v(t)))}}},T=["if","elseif","else","eval","each"],F="innerHTML",E=(t,e)=>{t[F]=e[F],e[F]=""};function S(s,n,i){let o,{func:l,as:r,dependencyList:a}=$(i||""),f=[],u=n.match(/if|else/);if(r=r||["$val","$key"],n.match(/else/)){let i=s,r=0;for(;i=i?.previousElementSibling;){let t="if";if(t=i.getAttribute("if")?"if":i.getAttribute("elseif")?"elseif":"",t&&f.push(i.H.get(t)?.name||""),r++>100){console.error("MFLD: No if start found");break}if(i.getAttribute("if"))break}a=[...a||[],...f],o=()=>{for(let t of f)if(e[t])return!1;return"else"==n||!0===l?.({$st:e,$fn:t})}}else o=l;let h=function(t,e,s,n){let i=c(d(),{updater:()=>e?.({$el:t,$st:k,$fn:C}),dependencyList:s,internal:!0});return n&&i.sub(n),i}(s,o,a,(i=>{if(void 0===i)return;let o=document.createElement("span");E(o,s),s.before(o),y(o,"out",{}),u&&!i||((t,e)=>{if(t instanceof Map)for(let[s,n]of t.entries())e(n,s);else try{let s=Array.isArray(t)?t:Array.from(t);if(s.length)s.forEach(e);else for(let s in t)e(t[s],s)}catch(e){console.error(`MFLD: ${t} is not iterable`)}})("each"==n?i:[i],((n,i)=>{let o=s.q?.cloneNode(!0);u||(o.innerHTML=o[F]?.replace(/\$:{([^}]*)}/g,((s,o)=>$(o,r[0],r[1]).func?.({$st:e,$fn:t,[r[0]]:n,[r[1]]:i})??""))||String(n)),s.append(o.content),y(s,"in",{})}))}));o&&s.v.add(o),s.H.set(n,h)}class A extends HTMLElement{q=null;v=new Set;H=new Map;connectedCallback(){this.q=this.querySelector("template")||(()=>{let t=document.createElement("template");return E(t,this),t})();let t="";for(let e of T){let s=this.getAttribute(e);null!=s&&(t&&console.error(`MFLD: Multiple templ directives '${t}' and '${e}'; '${t}' ignored`),t=e),null!==s&&S(this,e,s)}}disconnectedCallback(){this.v.forEach((t=>null))}static get observedAttributes(){return T}}window.templ||(window.templ=customElements.define("mf-templ",A));let D={store:(t,e)=>(e?.hasOwnProperty("value")||e?.hasOwnProperty("updater")||(e={value:e}),c(t,e)),ustore:(t,e)=>c(t,e),funcs:t=>{for(let e in t)MFLD.$fn[e]=t[e]},config:(t,e)=>{return s=t,void((n=e)?b.profiles={...b.profiles,[n]:s}:b={...b,...s});var s,n},onTick:t=>{var e;(e=t)&&o.push(e)},register:t=>v("string"==typeof t?document.querySelector(t):t),makeComponent:(t,e)=>{MFLD.comp[t]=class extends HTMLElement{template=null;onconnect;onadopted;ondisconnect;onAttributeChanged;constructor(){super(),e?.onconstruct?.bind(this)?.(),this.onconnect=e?.onconnect?.bind(this),this.onadopted=e?.onadopted?.bind(this),this.ondisconnect=e?.ondisconnect?.bind(this),this.onAttributeChanged=e?.onAttributeChanged?.bind(this),this.template=new M("COMPONENT",{ops:e?.options||{},element:e?.templ||document.getElementById(e?.selector||t)})}connectedCallback(){let t=this.attachShadow({mode:e?.shadow||"closed"}),s=(this.template?.o).content.cloneNode(!0);if(s){t.append(s);for(let e of Array.from(t.children))if("SLOT"==e.nodeName)for(let t of e.assignedNodes())v(t);else"TEMPLATE"!=e.nodeName&&v(e)}}attributeChangedCallback(t,e,s){this.onAttributeChanged?.(t,e,s)}disconnectedCallback(){this.ondisconnect?.()}adoptedCallback(){this.onadopted?.()}static get observedAttributes(){return e?.observedAttributes||[]}},MFLD.comp[t]&&customElements.define(t,MFLD.comp[t])},component:async t=>{}},k=MFLD.$st,C=MFLD.$fn;export{C as $fn,k as $st,D as Mfld};
//# sourceMappingURL=dev.manifold.js.map
