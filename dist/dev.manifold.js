window.MFLD||(window.MFLD={st:new Map,mut:new Map,$st:new Proxy(d,{get:(e,t)=>"string"==typeof t?e(t)?.value:void 0,set:(e,t,n)=>{if("string"==typeof t){let o=t.split(/[\.\[\]\?]{1,}/g).map((e=>parseFloat(e.trim())||e.trim())),s=e(o[0]),l=s.value;for(let e of o.slice(1)||[])l=l[e];l=n,s.update(l)}return!0}}),$fn:{},comp:{}});let{$fn:e,$st:t}=MFLD,n=[],o=new Set,s=0,l=[],i=e=>{e&&l.push(e)},r=e=>{"function"==typeof e?n.push(e):o.add(e),s||(s=requestAnimationFrame(f))};function f(i,r=0){if(r>100)return void console.error("MFLD: Recursion limit reached - check for circular refrences.");s=0;for(let e of n)e();let a=new Set;for(let n of o){let s=!1;for(let e of n.t)if(o.has(e)){s=!0;break}if(s)a.add(n);else{let o=n.o?.({$cur:n.value,$st:t,$fn:e,$el:n.l});n.update(void 0===o?n.value:o)}}n=[],o.clear(),a.size?(o=a,f(0,r+1)):(o.size&&f(0,r+1),l.forEach((e=>e())),l=[])}function a(e,t,n,o){r((()=>{"out"==t&&e.remove(),o?.()}))}function c(e){if(!e||!isNaN(e)||!0===e)return e;if(e instanceof Map||e instanceof Set)return c(Array.from(e.entries()||e));let t=0;for(let n of(new TextEncoder).encode(e?.toString()||""))t=(t<<5)-t+n;return t}class u{o;i=new Set;u;t=new Set;h=new Set;l;name;value;constructor(e,t){this.name=e,MFLD.st.set(e,this),this.l=t?.scope,this.value="function"!=typeof t?.value?t?.value:void 0,this.p(t)}p(e){return e?.dependencyList?.map((e=>{let t=d(e);return this.t.add(t),t.h.add(this),t})),this.value=e?.value,this.o=e?.updater,this.$(),this}sub(e,t=!0){this.i.add(e),t&&e(this.value)}update(e){setTimeout((()=>{let t="function"==typeof e?e(this.value):e,n=c(t);if(n!==this.u){this.value=t,this.u=n;for(let e of this.h)e.$();for(let e of Array.from(this.i))e(this.value)}return this.value}),0)}$(){r(this)}}function d(e,t){let n=MFLD.st.get(e);return t?n?n.p(t):new u(e,t):n||new u(e,t)}let h="mf-",p=/, {0,}/g,$=()=>`${Date.now()}.${Math.floor(1e5*Math.random())}`,m=(e,t)=>{let n=e.profiles?.[t.getAttribute("override")||""],o={...e,...n};for(let e in t?.attributes||[])for(let n of["fetch","trans"])if(e.startsWith(`${h}${n}_`))try{let s=e.split("_")[2],l=t.getAttribute(n);l?.match(/\{|\[/)?l=JSON.parse(l):parseInt(l||"")&&(l=parseInt(l)),Array.isArray(l)&&(l=l.map((e=>parseInt(e)||e))),o?.[n]?.[s]&&(o[n][s]=l)}catch(e){console.error(e)}return o},y=(e,t="$val",n="$key")=>{try{let[o,s]=e?.split(/\s{1,}as\s{1,}/)||[e,"value"],l=o?.match(/^\s{0,}(function)?\(.{0,}\)(=>)?\s{0,}/)?`(${o})()`:o,i=`let {$cur, $el, $st, $fn, ${t}, ${n}, $body} = ops;return ${l}`,r=s?.split?.(p)?.map?.((e=>e.trim()))||["value"]||[],f=Array.from(new Set([...o?.matchAll(/\$st\.(\w{1,})/g)].map((e=>e[1]))));return l?{func:new Function("ops",i),as:r,dependencyList:f}:{}}catch(e){return console.error(e),{}}};function w(e,t,n){t?.preventDefault();let o=e?.getAttribute("pushstate"),s=n;switch(o){case"":break;case void 0:return;default:s=`#${o}`}history.pushState(null,"",s)}function g(n,o,s,l){let i=d($(),{updater:()=>o?.({$el:n,$st:t,$fn:e}),dependencyList:s,internal:!0});return l&&i.sub(l),i}let M=(e,t,n,o,s,l,i)=>{let r=t=>L(t,s,n,o,e,!0,l,i);"$mount"===t?r():e.addEventListener(t,r)},b=(e,t,n,o)=>{let s=e.fetch?.externals?.find((e=>"$origin"===e.domain&&(t.startsWith(location.origin)||!t.match(/^(https?):\/\//))||t.startsWith(e.domain)));s||(s=t.startsWith(location.origin)?{domain:"$origin",script:"selected",style:"selected"}:void 0);let[l,i]=["style","script"].map((e=>Array.from(("all"==s?.[e]?n:o)?.querySelectorAll(e))));if("all"===s?.style)l.forEach((e=>o?.append(e)));else l.forEach((e=>e.parentNode?.removeChild(e)));for(let e of i)e.parentNode?.removeChild(e);return i},L=async(n,o,s,l,i,r,f,c)=>{n?.preventDefault();let u=f?f({$el:i,$st:t,$fn:e}):void 0,d="$form"===u?new FormData(i):u,h=await fetch(l,{...s.fetch?.request||{},headers:{...s.fetch?.request?.headers,MFLD:"true"},method:n?.target?.method||"get",body:"$form"===u||"string"==typeof d?d:JSON.stringify(d)}).catch((e=>{s.fetch?.err?.(e)})),p=h?.status,$=await(h?.[s.fetch?.resType||"text"]());if(p&&!1===s.fetch?.onCode?.(p,h))return;for(let e of["append","prepend","insert","replace"]){let t=i.getAttribute(e);if(null==t)continue;let[n,o]=t.split("->").map((e=>e.trim())),r=(new DOMParser).parseFromString($,"text/html"),f=r.querySelector(n),u=b(s,l,r,f);f&&a(f,"in",0,(()=>{c?.(i);for(let e of u){let t=document.createElement("script");t.textContent=e.textContent,i?.append(t)}})),a(o?i.querySelector(o):i,"out")}let m=i.getAttribute("resolve"),g=y(m||"")?.func;g?.({$el:i,$st:t,$fn:e,$body:$}),r&&w(i,n,l)},v={},F=["bind","sync","get","head","post","put","delete","patch","promote"],S=(e,t)=>{t?v.profiles={...v.profiles,[t]:e}:v={...v,...e}};window.addEventListener("popstate",(()=>{location.reload()}));let k=(n,o=!1)=>{if(console.log("Registering",n),!n||n?.nodeType==Node.TEXT_NODE)return;n?.classList.contains("_mfld")&&(o=!0);let s=":not(._mfld)",l=n.querySelectorAll(`[${h}${F.join(`]${s},[${h}`)}]${s}`);for(let s of o?[...l]:[n,...l]){console.log("Registering",s);let n=m(structuredClone(v),s);console.log(s.attributes);for(let o of s.attributes){if(!o.name.startsWith(h)||null===o.value)continue;let l=o.name.replace(h,"");if("promote"!=l)for(let i of s.getAttribute(o.name)?.split(";;")||[""]){let r=!/bind|sync/.test(o.name),f=i?.split(/\s*->\s*/g),a=r&&f.pop()||"",c=r||"sync"==l?f.shift()?.match(/[^\(\)]{1,}/g)?.pop()?.split(p)?.map((e=>e.trim()))||[]:null,u=f?.[0]||"";console.log(l,"SETTING:",i,"TRIGGERS:",c,"FUNCSTR:",u,"HREF:",a);let{func:d,as:h,dependencyList:$}=y(u);if(console.log("FUNC FROM STR",u,d),c)for(let o of c)if(console.log("HANDLING TRIGGERS",l),"sync"==l){console.log(s,t,e,d);let n=n=>{d?.({$el:s,$st:t,$fn:e}),w(s,n)};"$mount"===o?n():s.addEventListener(o,n)}else M(s,o,n,a,l,d);else g(s,d,$)}else{let[e,t,o,l]="A"==s.tagName?["get",s.href,void 0,"click"]:[s.method?.toLowerCase(),s.action,()=>"$form","submit"];t&&M(s,l,n,t,e,o,(e=>k(e)))}}}};k(document.body);let D=["if","elseif","else","eval","each"],_="innerHTML",A=(e,t)=>{e[_]=t[_],t[_]=""};function T(n,o,s){let l,{func:i,as:r,dependencyList:f}=y(s||""),c=[],u=o.match(/if|else/);if(r=r||["$val","$key"],o.match(/else/)){let s=n,r=0;for(;s=s?.previousElementSibling;){let e="if";if(e=s.getAttribute("if")?"if":s.getAttribute("elseif")?"elseif":"",e&&c.push(s.m.get(e)?.name||""),r++>100){console.error("MFLD: No if start found");break}if(s.getAttribute("if"))break}f=[...f||[],...c],l=()=>{for(let e of c)if(t[e])return!1;return"else"==o||!0===i?.({$st:t,$fn:e})}}else l=i;let d=g(n,l,f,(s=>{if(void 0===s)return;let l=document.createElement("span");A(l,n),n.before(l),a(l,"out"),u&&!s||((e,t)=>{if(e instanceof Map)for(let[n,o]of e.entries())t(o,n);else try{let n=Array.isArray(e)?e:Array.from(e);if(n.length)n.forEach(t);else for(let n in e)t(e[n],n)}catch(t){console.error(`MFLD: ${e} is not iterable`)}})("each"==o?s:[s],((o,s)=>{let l=n.M?.cloneNode(!0);u||(l.innerHTML=l[_]?.replace(/\$:{([^}]*)}/g,((n,l)=>y(l,r[0],r[1]).func?.({$st:t,$fn:e,[r[0]]:o,[r[1]]:s})??""))||String(o)),n.append(l.content),a(n,"in")}))}));l&&n.L.add(l),n.m.set(o,d)}class C extends HTMLElement{M=null;L=new Set;m=new Map;connectedCallback(){this.M=this.querySelector("template")||(()=>{let e=document.createElement("template");return A(e,this),e})();let e="";for(let t of D){let n=this.getAttribute(t);null!=n&&(e&&console.error(`MFLD: Multiple templ statements '${e}' and '${t}'; '${e}' ignored`),e=t),null!==n&&T(this,t,n)}}disconnectedCallback(){this.L.forEach((e=>null))}static get observedAttributes(){return D}}window.templ||(window.templ=customElements.define("mf-templ",C));let E={make:(e,t)=>(t?.hasOwnProperty("value")||t?.hasOwnProperty("updater")||(t={value:t}),d(e,t)),untyped:(e,t)=>d(e,t),funcs:e=>{for(let t in e)MFLD.$fn[t]=e[t]}},N={make:(e,t)=>{MFLD.comp[e]=class extends HTMLElement{template=null;onconnect;onadopted;ondisconnect;onAttributeChanged;constructor(){super(),t?.onconstruct?.bind(this)?.(),this.onconnect=t?.onconnect?.bind(this),this.onadopted=t?.onadopted?.bind(this),this.ondisconnect=t?.ondisconnect?.bind(this),this.onAttributeChanged=t?.onAttributeChanged?.bind(this),this.template=document.getElementById(t?.selector||e)||document.createElement("template")}connectedCallback(){let e=this.attachShadow({mode:t?.shadow||"closed"}),n=this.template.content.cloneNode(!0);if(n){e.append(n);for(let t of Array.from(e.children))if("SLOT"==t.nodeName)for(let e of t.assignedNodes())k(e);else"TEMPLATE"!=t.nodeName&&k(t)}}attributeChangedCallback(e,t,n){this.onAttributeChanged?.(e,t,n)}disconnectedCallback(){this.ondisconnect?.()}adoptedCallback(){this.onadopted?.()}static get observedAttributes(){return t?.observedAttributes||[]}},MFLD.comp[e]&&customElements.define(e,MFLD.comp[e])},register:async e=>{}};export{e as $fn,t as $st,N as component,S as config,i as onTick,E as store};
//# sourceMappingURL=dev.manifold.js.map
