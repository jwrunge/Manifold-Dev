let t="mf_",e=/, {0,}/g,n=()=>`${Date.now()}.${Math.floor(1e5*Math.random())}`,o=(e,n)=>{let o=e.profiles?.[n.dataset?.override||""],s={...e,...o};for(let e in n.dataset)for(let o of["fetch","trans"])if(e.startsWith(`${t}${o}_`))try{let t=e.split("_")[2],i=n.dataset[e];i?.match(/\{|\[/)?i=JSON.parse(i):parseInt(i||"")&&(i=parseInt(i)),Array.isArray(i)&&(i=i.map((t=>parseInt(t)||t))),s[o][t]=i}catch(t){console.error(t)}return s},s=(t,n="$val",o="$key")=>{try{let[s,i]=t?.split(/\s{1,}as\s{1,}/)||[t,"value"],r=`let {$el, $st, $fn, ${n}, ${o}, $body} = ops;return ${s?.match(/^\s{0,}(function)?\(.{0,}\)(=>)?\s{0,}/)?`(${s})()`:s}`,l=i?.split?.(e)?.map?.((t=>t.trim()))||["value"]||[];return{func:new Function("ops",r),as:l}}catch(t){return console.error(t),{}}};function i(t,e,n){e?.preventDefault();let o=t.t("pushstate"),s=n;switch(o){case"":break;case void 0:return;default:s=`#${o}`}history.pushState(null,"",s)}let r=[],l=0,a=[],c=t=>{r.push(t),l||(l=requestAnimationFrame(d))},f=(t,e,n,o)=>{if(!(o.trans?.smart??1))return;let{paddingTop:s,paddingBottom:i}=e instanceof Element?getComputedStyle(e):{paddingTop:0,paddingBottom:0},r=document.createElement("div");r.style.height=`calc(${Math.abs(n-(t?.clientHeight||0))}px - ${s} - ${i})`,e?.after(r)},u=(t,e)=>{if(!e.trans?.smart??1)return;let n=("number"==typeof e?.trans?.dur?e?.trans?.dur:e?.trans?.dur?.[0]||0)/2;c((()=>{t?.animate?.([{height:""},{height:`${t.clientHeight||0}px`}],n)}))},d=()=>{l=0;for(let t of r){if("function"==typeof t){t();continue}let e=t.out?t.out.clientHeight:0,n="inner"==t.relation;if("prepend"==t.relation)f?.(t?.in,t?.out,e,t.ops),h(t.in,"in",t.ops,(()=>{t?.in&&t.out?.prepend(t.in),u?.(t?.in,t.ops)}));else{if(["inner","outer"].includes(t.relation)){let e=t.out?.cloneNode(!0);e&&(t.out?.after(e),n&&(e.style.border="none",t?.out?.replaceChildren()),h(e,"out",t.ops,void 0,t?.out,n))}f?.(t.in,t.out,e,t.ops),h(t.in,"in",t.ops,(()=>{t.in&&("outer"==t.relation?t.out?.replaceWith(t.in):t.out?.appendChild(t.in)),u?.(t.in,t.ops)}))}t.done?.(t.in)}a.forEach((t=>t())),a=[],r=[]},h=(e,n,o,s,i,r=!1,l)=>{if(e?.nodeType==Node.TEXT_NODE&&(e.replaceWith(document?.createElement("div")),e.textContent=e.textContent),e){const a=Array.isArray(o.trans?.dur)?o.trans?.dur["in"==n?0:1]||o.trans?.dur[0]:o.trans?.dur||0,f=o?.trans?.class||`${t}trans`;if(e?.classList?.add(f),o.trans?.hooks?.[`${n}-start`]?.(e),"out"==n){if(!(i=i||e))return;let t={};(o.trans?.smart??1)&&!r&&(t=p(i)),c((()=>{(o.trans?.smart??1)&&r&&i&&(t=p(i)),(o.trans?.smart??1)&&(e.style.position="fixed",e.style.width=t.w,e.style.left=t.left,e.style.top=t.top,e.style.margin="0"),a&&(e.style.transitionDuration=`${a}ms`),e.classList?.add("out")}))}else e?.classList?.add("in"),a&&(e.style.transitionDuration=`${a}ms`),s?.(),setTimeout((()=>{c((()=>{setTimeout((()=>c((()=>e?.classList?.remove(n)))),0)}))}),o.trans?.swap||0);setTimeout((()=>{c((()=>{"out"==n&&e?.remove(),e?.classList?.remove(f),o.trans?.hooks?.[`${n}-end`]?.(e),e.style.transitionDuration="","in"==n&&l?.(e)}))}),a+("in"==n&&o.trans?.swap||0))}},p=t=>{let e=getComputedStyle(t),n=t.getBoundingClientRect();return{w:`calc(${t.clientWidth}px - ${e.paddingLeft} - ${e.paddingRight})`,left:`calc(${n.left}px + ${window.scrollX}px)`,top:`calc(${n.top}px + ${window.scrollY}px)`}};function $(t){if(!t)return 0;if("number"==typeof t||!0===t)return t;if(t instanceof Map||t instanceof Set)return $(Array.from(t.entries()||t));let e=0;for(let n of(new TextEncoder).encode(t?.toString()||""))e=(e<<5)-e+n;return e}class m{o;i=new Map;l;u=new Set;h=new Set;p;$;name;value;constructor(t,e){this.name=t,this.p="global",this.value=void 0,this.m(t,e)}m(t,e){return this.name=t,this.p=e?.scope||document.currentScript||"global",MFLD.st.set(t,this),e?.upstream?.map((t=>{let e=y(t);return this.u.add(e),e.h.add(this),e})),this.value=e?.value,this.o=e?.updater,this.v(),this}sub(t,e,o=!0){this.i.set(e||n(),t),o&&t(this.value)}update(t){this.$&&clearTimeout(this.$),this.$=setTimeout((()=>{c((()=>{let e="function"==typeof t?t(this.value):t,n=$(e);if(n!==this.l){this.value=e,this.l=n.toString();for(let t of this.h)t.v();for(let[t,e]of this.i)e(this.value,t)}return this.value}))}),0)}v(){let t=this.o?.(Array.from(this.u).map((t=>t.value))||[],this.value);this.update(void 0===t?this.value:t)}}function y(t,e){let n=MFLD.st.get(t);return e?n?n.m(t,e):new m(t,e):n||new m(t,e)}window.MFLD||(window.MFLD={st:new Map,mut:new Map,$st:new Proxy(y,{get:(t,e)=>"string"==typeof e?t(e)?.value:void 0,set:(t,e,n)=>{if("string"==typeof e){let o=e.split(/[\.\[\]\?]{1,}/g).map((t=>parseFloat(t.trim())||t.trim())),s=t(o[0]),i=s.value;for(let t of o.slice(1)||[])i=i[t];i=n,s.update(i)}return!0}}),$fn:{},comp:{}});let{$fn:g,$st:w}=MFLD;const b=(t,e,n,o,s,i,r)=>{const l=e=>v(e,s,n,o,t,!0,i,r);"$mount"===e?l():t.addEventListener(e,l)},v=async(e,n,o,r,l,a,f,u)=>{e?.preventDefault(),e?.stopPropagation(),n||(n=e?.target?.method||"get");let d=o.fetch?.externals?.find((t=>"$origin"===t.domain&&(r.startsWith(location.origin)||!r.match(/^(https?):\/\//))||r.startsWith(t.domain)));d||(d=r.startsWith(location.origin)?{domain:"$origin",scripts:"selected",styles:"selected"}:void 0);let h=f?f({$el:l,$st:w,$fn:g}):void 0,p="$form"===h?new FormData(l):h,$=await fetch(r,{...o.fetch?.request||{},headers:{...o.fetch?.request?.headers,MFLD:"true"},method:n,body:"$form"===h||"string"==typeof p?p:JSON.stringify(p)}).catch((t=>{o.fetch?.err?.(t)})),m=$?.status;if(m&&!1===o.fetch?.onCode?.(m,$))return;let y=await($?.[o.fetch?.resType||"text"]());for(let e of["append","prepend","inner","outer"]){let n=l.dataset[`${t}${e}`];if(void 0===n)continue;let[s,i]=n.split("->").map((t=>t.trim())),r=(new DOMParser).parseFromString(y,"text/html"),f=r.querySelector(s||"body");if(r){let t=[];if(d?.styles&&"none"!==d.styles||r.querySelectorAll("style").forEach((t=>t.parentNode?.removeChild(t))),"all"===d?.styles&&r.querySelectorAll("style").forEach((t=>f?.appendChild(t))),("all"===d?.scripts?r:f)?.querySelectorAll("script").forEach((e=>{["all","selected"].includes(d?.scripts||"")&&t.push(e),e.parentNode?.removeChild(e)})),a&&f)c({in:f,out:i?document.querySelector(i):l,relation:e,ops:o,done:e=>{u?.(e);for(let n of t){let t=document.createElement("script");t.textContent=n.textContent,e?.appendChild(t)}}});else if(f){document.body.appendChild(f);for(let e of t){let t=document.createElement("script");for(let n of e.attributes)t.setAttribute(n.name,n.value);t.textContent=e.textContent,f.before(t)}}}}let b=l.dataset?.[`${t}resolve`],v=s(b||"")?.func;v?.({$el:l,$st:w,$fn:g,$body:y}),a&&i(l,e,r)},M=(t,e,n,o=!1)=>{const s=o?"previousElementSibling":"nextElementSibling";return e?.(t)?t:M(n?.(t)||t?.[s],e,n,o)},_=(t,e,o)=>y(n(),{upstream:t,updater:()=>e?.({$el:o,$st:w,$fn:g})}),T=new Map;class x{M=null;_=new Map;T=new Set;constructor(t){t.query?this.M=document.querySelector(t.query):this.M=document.createElement(t.create.name)}t(e){return this.M?.dataset[`${t}${e}`]}L(t,e){this._?.set(t,e)}A(t){this.T?.add(t)}F(){this._?.forEach(((t,e)=>{this.M?.removeEventListener(e,t)})),this.T?.forEach((t=>{this.T?.delete(t)})),this.T=this._=null,this.M=null,this.M&&T.delete(this.M)}}let L=(t,e,n)=>{_(n,(()=>e?.({$el:t,$st:w,$fn:g})),t)},A=(t,e,n)=>{let o=e=>{n?.({$el:t,$st:w,$fn:g}),e&&i(t,e)};"$mount"===e?o():x.L(e,o)},F=(e,n,o,i,r,l)=>{let a,f,u=document.createElement("template"),d=(t=>{const e="TEMPLATE";if(t.tagName===e)return t;const n=document.createElement(e);return n.content.appendChild(t.cloneNode(!0)),t.replaceWith(n),n})(e.cloneNode(!0)),p=n.match(/if|else/),$=n.match(/(else|elseif)(\s|$)/),m=[];if(u.classList.add(`${n}-start`),d.classList.add(`${n}-end`),e.before(u),e.after(d),e.remove(),p){if($){let e=M(u,(e=>e?.classList?.contains(`${t}if-end`)),null,!0);M(e,(t=>t==d),(e=>{e?.dataset?.[`${t}cstore`]&&m.push(e.dataset[`${t}cstore`]||"")}))}f=()=>{if($)for(let t of m)if(w[t])return!1;return"else"===$?.[0]||!0===i?.({el:e,$st:w,$fn:g})}}a=_([...r,...m],p?f:i,d),d.dataset[`${t}cstore`]=a.name,a.sub((t=>{void 0!==t&&c((()=>{M(u?.nextElementSibling,(t=>t?.classList?.contains(`${n}-end`)),(t=>{t&&h(t,"out",l,(()=>t.remove()))})),p&&!t||((t,e)=>{if(t instanceof Map)for(const[n,o]of t.entries())e(o,n);else try{const n=Array.isArray(t)?t:Array.from(t);if(n.length)n.forEach(e);else for(const n in t)e(t[n],n)}catch(e){console.error(`${t} is not iterable`)}})(n.match(/each/)?t:[t],((t,n)=>{let i=d.cloneNode(!0);if(!p){let r=d.innerHTML.replace(/\$:{([^}]*)}/g,((i,r)=>s(r,o[0],o[1]).func?.({$el:e,$st:w,$fn:g,[o[0]]:t,[o[1]]:n})||""))||"";i.innerHTML&&(i.innerHTML=r)}for(let e of Array.from(i.content.children))e.innerHTML||(e.innerHTML=String(t)),d.before(e),h(e,"in",l)}))}))}))},S={},D=["bind","sync","templ","if","elseif","else","each","get","head","post","put","delete","patch","promote"].map((e=>`${t}${e}`));window.addEventListener("popstate",(()=>{location.reload()}));let E=i=>{if(i?.nodeType==Node.TEXT_NODE)return;let r=(i||document.body).querySelectorAll(`[data-${D.join("],[data-")}],a,form`);for(let l of[i,...r]){let i=o(structuredClone(S),l);if(l.id||(l.id=n()),void 0!==l.dataset?.[`${t}promote`]){let[t,e,n,o]="A"==l.tagName?["get",l.href,void 0,"click"]:[l.method.toLowerCase(),l.action,()=>"$form","submit"];if(e){b(l,o,i,e,t,n,(t=>E(t)));continue}}for(let n in l.dataset)if(D.includes(n))for(let o of l.dataset?.[n]?.split(";;")||[]){let r=!!/get|head|post|put|delete|patch/.test(n),a=o?.split(/\s*->\s*/g),c=r&&a.pop()||"",f=r||/sync/.test(n)?a.shift()?.match(/[^\(\)]{1,}/g)?.pop()?.split(e)?.map((t=>t.trim())):[]||[],u=a?.[0]||"",d=Array.from(new Set([...u?.matchAll(/\$st\.(\w{1,})/g)].map((t=>t[1])))),{func:h,as:p}=s(u);if(/each|templ|if|else/.test(n))F(l,n,p||[],h,d,i);else{f?.length||(f=[""]);for(let e of f)/bind/.test(n)?L(l,h,d):/sync/.test(n)?A(l,e,h):b(l,e,i,c,n.replace(t,""),h)}}}},C={store:(t,e)=>(e?.hasOwnProperty("value")||e?.hasOwnProperty("updater")||(e={value:e}),y(t,e)),ustore:(t,e)=>y(t,e),funcs:t=>{for(let e in t)MFLD.$fn[e]=t[e]},config:(t,e)=>{return n=t,void((o=e)?S.profiles={...S.profiles,[o]:n}:S={...S,...n});var n,o},onTick:t=>{var e;(e=t)&&a.push(e)},register:t=>E("string"==typeof t?document.querySelector(t):t),makeComponent:(t,e)=>{MFLD.comp[t]=class extends HTMLElement{template=null;connected;adopted;disconnected;attributeChanged;constructor(){super(),e?.constructor?.bind(this)?.(),this.connected=e?.connected?.bind(this),this.adopted=e?.adopted?.bind(this),this.disconnected=e?.disconnected?.bind(this),this.attributeChanged=e?.attributeChanged?.bind(this),this.template=e?.templ||document.getElementById(e?.selector||t),"TEMPLATE"!=this.template?.nodeName&&(this.template=null)}connectedCallback(){const t=this.attachShadow({mode:e?.shadow||"closed"}),n=this.template?.content.cloneNode(!0);if(n){t.append(n);for(let e of Array.from(t.children))if("SLOT"==e.nodeName)for(let t of e.assignedNodes())E(t);else"TEMPLATE"!=e.nodeName&&E(e)}}attributeChangedCallback(t,e,n){this.attributeChanged?.(t,e,n)}disconnectedCallback(){this.disconnected?.()}adoptedCallback(){this.adopted?.()}static get observedAttributes(){return e?.observedAttributes||[]}},MFLD.comp[t]&&customElements.define(t,MFLD.comp[t])},component:async e=>{await v(void 0,"get",{fetch:{externals:[{domain:"$origin",scripts:"all",styles:"selected"}]}},e,{dataset:{[`${t}append`]:"template -> body"}},!1)}},k=MFLD.$st,P=MFLD.$fn;export{P as $fn,k as $st,C as Mfld};
//# sourceMappingURL=dev.manifold.js.map
