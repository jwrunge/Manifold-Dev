window.MFLD||(window.MFLD={st:new Map,mut:new Map,$st:new Proxy(d,{get:(e,t)=>"string"==typeof t?e(t)?.value:void 0,set:(e,t,n)=>{if("string"==typeof t){let s=t.split(/[\.\[\]\?]{1,}/g).map((e=>parseFloat(e.trim())||e.trim())),o=e(s[0]),l=o.value;for(let e of s.slice(1)||[])l=l[e];l=n,o.update(l)}return!0}}),$fn:{},comp:{}});let{$fn:e,$st:t}=MFLD,n=[],s=new Set,o=0,l=[],i=e=>{e&&l.push(e)},r=e=>{"function"==typeof e?n.push(e):s.add(e),o||(o=requestAnimationFrame(f))};function f(i,r=0){if(r>100)return void console.error("MFLD: Recursion limit reached - check for circular refrences.");o=0;for(let e of n)e();let a=new Set;for(let n of s){let o=!1;for(let e of n.t)if(s.has(e)){o=!0;break}if(o)a.add(n);else{let s=n.o?.({$cur:n.value,$st:t,$fn:e,$el:n.l});n.update(void 0===s?n.value:s)}}n=[],s.clear(),a.size?(s=a,f(0,r+1)):(s.size&&f(0,r+1),l.forEach((e=>e())),l=[])}function a(e,t,n){"in"==t&&console.log("RUNNING TRANSITION"),r((()=>{console.log("RUNNING UPDATE"),"out"==t&&e.remove(),n?.()}))}function c(e){if(!e||!isNaN(e)||!0===e)return e;if(e instanceof Map||e instanceof Set)return c(Array.from(e.entries()||e));let t=0;for(let n of(new TextEncoder).encode(e?.toString()||""))t=(t<<5)-t+n;return t}class u{o;i=new Set;u;t=new Set;h=new Set;l;name;value;constructor(e,t){this.name=e,MFLD.st.set(e,this),this.l=t?.scope,this.value="function"!=typeof t?.value?t?.value:void 0,this.p(t)}p(e){return e?.dependencyList?.map((e=>{let t=d(e);return this.t.add(t),t.h.add(this),t})),this.value=e?.value,this.o=e?.updater,this.$(),this}sub(e,t=!0){this.i.add(e),t&&e(this.value)}update(e){setTimeout((()=>{let t="function"==typeof e?e(this.value):e,n=c(t);if(n!==this.u){this.value=t,this.u=n;for(let e of this.h)e.$();for(let e of Array.from(this.i))e(this.value)}return this.value}),0)}$(){r(this)}}function d(e,t){let n=MFLD.st.get(e);return t?n?n.p(t):new u(e,t):n||new u(e,t)}let h="mf-",p=/, {0,}/g,$=()=>`${Date.now()}.${Math.floor(1e5*Math.random())}`,m=(e,t)=>{let n=e.profiles?.[t.getAttribute("override")||""],s={...e,...n};for(let e in t?.attributes||[])for(let n of["fetch","trans"])if(e.startsWith(`${h}${n}_`))try{let o=e.split("_")[2],l=t.getAttribute(n);l?.match(/\{|\[/)?l=JSON.parse(l):parseInt(l||"")&&(l=parseInt(l)),Array.isArray(l)&&(l=l.map((e=>parseInt(e)||e))),s?.[n]?.[o]&&(s[n][o]=l)}catch(e){console.error(e)}return s},y=(e,t="$val",n="$key")=>{try{let[s,o]=e?.split(/\s{1,}as\s{1,}/)||[e,"value"],l=s?.match(/^\s{0,}(function)?\(.{0,}\)(=>)?\s{0,}/)?`(${s})()`:s,i=`let {$cur, $el, $st, $fn, ${t}, ${n}, $body} = ops;return ${l}`,r=o?.split?.(p)?.map?.((e=>e.trim()))||["value"]||[],f=Array.from(new Set([...s?.matchAll(/\$st\.(\w{1,})/g)].map((e=>e[1]))));return l?{func:new Function("ops",i),as:r,dependencyList:f}:{}}catch(e){return console.error(e),{}}};function w(e,t,n){t?.preventDefault();let s=e?.getAttribute("pushstate"),o=n;switch(s){case"":break;case void 0:return;default:o=`#${s}`}history.pushState(null,"",o)}function b(n,s,o,l){let i=d($(),{updater:()=>s?.({$el:n,$st:t,$fn:e}),dependencyList:o,internal:!0});return l&&i.sub(l),i}let g=(e,t,n,s,o,l,i)=>{let r=t=>v(t,o,n,s,e,!0,l,i);"$mount"===t?r():e.addEventListener(t,r)},M=(e,t,n,s)=>{let o=e.fetch?.externals?.find((e=>"$origin"===e.domain&&(t.startsWith(location.origin)||!t.match(/^(https?):\/\//))||t.startsWith(e.domain)));o||(o=t.startsWith(location.origin)?{domain:"$origin",script:"selected",style:"selected"}:void 0);let[l,i]=["style","script"].map((e=>Array.from(("all"==o?.[e]?n:s)?.querySelectorAll(e))));if("all"===o?.style)l.forEach((e=>s?.append(e)));else l.forEach((e=>e.parentNode?.removeChild(e)));for(let e of i)e.parentNode?.removeChild(e);return i},v=async(n,s,o,l,i,r,f,c)=>{n?.preventDefault();let u=f?f({$el:i,$st:t,$fn:e}):void 0,d="$form"===u?new FormData(i):u,h=await fetch(l,{...o.fetch?.request||{},headers:{...o.fetch?.request?.headers,MFLD:"true"},method:s||n?.target?.method||"get",body:"$form"===u||"string"==typeof d?d:JSON.stringify(d)}).catch((e=>{o.fetch?.err?.(e)})),p=h?.status,$=await(h?.[o.fetch?.resType||"text"]());if(p&&!1===o.fetch?.onCode?.(p,h))return;for(let e of["append","prepend","insert","replace"]){let t=i.getAttribute(e);if(null==t)continue;let[n,s]=t.split("->").map((e=>e.trim())),r=(new DOMParser).parseFromString($,"text/html"),f=r.querySelector(n),u=M(o,l,r,f);f&&a(f,"in",(()=>{c?.(i);for(let e of u){let t=document.createElement("script");t.textContent=e.textContent,i?.append(t)}})),a(s?i.querySelector(s):i,"out")}let m=i.getAttribute("resolve"),b=y(m||"")?.func;b?.({$el:i,$st:t,$fn:e,$body:$}),r&&w(i,n,l)},L={},N=["bind","sync","get","head","post","put","delete","patch","promote"],k=(e,t)=>{t?L.profiles={...L.profiles,[t]:e}:L={...L,...e}};window.addEventListener("popstate",(()=>{location.reload()}));let A=(n,s=!1)=>{if(!n||n?.nodeType==Node.TEXT_NODE)return;let o=n.querySelectorAll(`[${h}${N.join(`],[${h}`)}]`);for(let l of s?[...o]:[n,...o]){if(console.log("Registering",l),l.classList.contains("_mfld"))continue;l.classList.add("_mfld");let n=m(structuredClone(L),l);for(let s of l.attributes){if(!s.name.startsWith(h)||null===s.value)continue;let o=s.name.replace(h,"");if("promote"!=o)for(let i of l.getAttribute(s.name)?.split(";;")||[""]){let r=!/bind|sync/.test(s.name),f=i?.split(/\s*->\s*/g),a=r&&f.pop()||"",c=r||"sync"==o?f.shift()?.match(/[^\(\)]{1,}/g)?.pop()?.split(p)?.map((e=>e.trim()))||[]:null,u=f?.[0]||"",{func:d,as:h,dependencyList:$}=y(u);if(c)for(let s of c)if("sync"==o){let n=n=>{d?.({$el:l,$st:t,$fn:e}),w(l,n)};"$mount"===s?n():l.addEventListener(s,n)}else g(l,s,n,a,o,d);else b(l,d,$)}else{let[e,t,s,o]="A"==l.tagName?["get",l.href,void 0,"click"]:[l.method?.toLowerCase(),l.action,()=>"$form","submit"];t&&g(l,o,n,t,e,s,(e=>A(e)))}}}};A(document.body);let D=["if","elseif","else","eval","each"],F="innerHTML",S=(e,t)=>{e[F]=t[F],t[F]=""};function _(n,s,o){let l,{func:i,as:r,dependencyList:f}=y(o||""),c=[],u=s.match(/if|else/);if(r=r||["$val","$key"],s.match(/else/)){let o=n,r=0;for(;o=o?.previousElementSibling;){let e="if";if(e=o.getAttribute("if")?"if":o.getAttribute("elseif")?"elseif":"",e&&c.push(o.m.get(e)?.name||""),r++>100){console.error("MFLD: No if start found");break}if(o.getAttribute("if"))break}f=[...f||[],...c],l=()=>{for(let e of c)if(t[e])return!1;return"else"==s||!0===i?.({$st:t,$fn:e})}}else l=i;let d=b(n,l,f,(o=>{if(console.log("RUNNING SUB",o),void 0===o)return;let l=document.createElement("span");S(l,n),n.before(l),a(l,"out"),u&&!o||((e,t)=>{if(e instanceof Map)for(let[n,s]of e.entries())t(s,n);else try{let n=Array.isArray(e)?e:Array.from(e);if(n.length)n.forEach(t);else for(let n in e)t(e[n],n)}catch(t){console.error(`MFLD: ${e} is not iterable`)}})("each"==s?o:[o],((s,o)=>{let l=n.M?.cloneNode(!0);u||(l.innerHTML=l[F]?.replace(/\$:{([^}]*)}/g,((n,l)=>y(l,r[0],r[1]).func?.({$st:t,$fn:e,[r[0]]:s,[r[1]]:o})??""))||String(s)),n.append(l.content),a(n,"in",(()=>A(n,!0)))}))}));l&&n.v.add(l),n.m.set(s,d)}class T extends HTMLElement{M=null;v=new Set;m=new Map;connectedCallback(){this.M=this.querySelector("template")||(()=>{let e=document.createElement("template");return S(e,this),e})();let e="";for(let t of D){let n=this.getAttribute(t);null!=n&&(e&&console.error(`MFLD: Multiple templ statements '${e}' and '${t}'; '${e}' ignored`),e=t),null!==n&&_(this,t,n)}}disconnectedCallback(){this.v.forEach((e=>null))}static get observedAttributes(){return D}}window.templ||(window.templ=customElements.define("mf-templ",T));let C={make:(e,t)=>(t?.hasOwnProperty("value")||t?.hasOwnProperty("updater")||(t={value:t}),d(e,t)),untyped:(e,t)=>d(e,t),funcs:e=>{for(let t in e)MFLD.$fn[t]=e[t]}},E={make:(e,t)=>{MFLD.comp[e]=class extends HTMLElement{template=null;onconnect;onadopted;ondisconnect;onAttributeChanged;constructor(){super(),t?.onconstruct?.bind(this)?.(),this.onconnect=t?.onconnect?.bind(this),this.onadopted=t?.onadopted?.bind(this),this.ondisconnect=t?.ondisconnect?.bind(this),this.onAttributeChanged=t?.onAttributeChanged?.bind(this),this.template=document.getElementById(t?.selector||e)||document.createElement("template")}connectedCallback(){let e=this.attachShadow({mode:t?.shadow||"closed"}),n=this.template.content.cloneNode(!0);if(n){e.append(n);for(let t of Array.from(e.children))if("SLOT"==t.nodeName)for(let e of t.assignedNodes())A(e);else"TEMPLATE"!=t.nodeName&&A(t)}}attributeChangedCallback(e,t,n){this.onAttributeChanged?.(e,t,n)}disconnectedCallback(){this.ondisconnect?.()}adoptedCallback(){this.onadopted?.()}static get observedAttributes(){return t?.observedAttributes||[]}},MFLD.comp[e]&&customElements.define(e,MFLD.comp[e])},register:async e=>{}};export{e as $fn,t as $st,E as component,k as config,i as onTick,C as store};
//# sourceMappingURL=dev.manifold.js.map
