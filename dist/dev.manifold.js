window.MFLD||(window.MFLD={st:new Map,mut:new Map,$st:new Proxy(f,{get:(t,e)=>"string"==typeof e?t(e)?.value:void 0,set:(t,e,s)=>{if("string"==typeof e){let n=e.split(/[\.\[\]\?]{1,}/g).map((t=>parseFloat(t.trim())||t.trim())),i=t(n[0]),o=i.value;for(let t of n.slice(1)||[])o=o[t];o=s,i.update(o)}return!0}}),$fn:{},comp:{}});let{$fn:t,$st:e}=MFLD,s=[],n=0,i=[],o=t=>{s.push(t),n||(n=requestAnimationFrame(r))},r=()=>{n=0;for(let t of s)if("function"!=typeof t){if("prepend"==t.relation)t.in.t("in",(()=>t.in&&t.out?.i(t.in.o,"prepend",!1)));else{if(["inner","outer"].includes(t.relation)){let e=t.out?.i(t.out?.o,"after");"inner"==t.relation&&(e.style.border="none",t?.out?.o?.replaceChildren()),t.out.t("out")}t.in.t("in",(()=>{"outer"==t.relation?t.out?.l(t.in):t.out?.i(t.in.o,"appendChild",!1)}))}t.done?.(t.in)}else t();i.forEach((t=>t())),i=[],s=[]};function l(t){if(!t||!isNaN(t)||!0===t)return t;if(t instanceof Map||t instanceof Set)return l(Array.from(t.entries()||t));let e=0;for(let s of(new TextEncoder).encode(t?.toString()||""))e=(e<<5)-e+s;return e}class a{u;h=new Set;p;$=new Set;m=new Set;_;M;name;value;constructor(t,e){this.name=t,MFLD.st.set(t,this),this._=e?.scope,this.value="function"!=typeof e?.value?e?.value:void 0,this.v(e)}v(t){return t?.dependencyList?.map((t=>{let e=f(t);return this.$.add(e),e.m.add(this),e})),this.value=t?.value,this.u=t?.updater,this.L(),this}sub(t,e=!0){this.h.add(t),e&&t(this.value)}update(t){this.M&&clearTimeout(this.M),this.M=setTimeout((()=>{o((()=>{let e="function"==typeof t?t(this.value):t,s=l(e);if(s!==this.p){this.value=e,this.p=s.toString();for(let t of this.m)t.L();for(let t of Array.from(this.h))t(this.value)}return this.value}))}),0)}L(){let s=this.u?.({$cur:this.value,$st:e,$fn:t,$el:this._?.o});this.update(void 0===s?this.value:s)}}function f(t,e){let s=MFLD.st.get(t);return e?s?s.v(e):new a(t,e):s||new a(t,e)}let u="data-mf-",c=/, {0,}/g,h=(t,e)=>{let s=t.profiles?.[e.S("override")||""],n={...t,...s};for(let t of e.o?.attributes||[])for(let e of["fetch","trans"]){let s=t.name;if(s.startsWith(`${u}${e}_`))try{let i=s.split("_")[2],o=t.value;o?.match(/\{|\[/)?o=JSON.parse(o):parseInt(o||"")&&(o=parseInt(o)),Array.isArray(o)&&(o=o.map((t=>parseInt(t)||t))),n[e][i]=o}catch(t){console.error(t)}}return n},p=(t,e="$val",s="$key")=>{try{let[n,i]=t?.split(/\s{1,}as\s{1,}/)||[t,"value"],o=n?.match(/^\s{0,}(function)?\(.{0,}\)(=>)?\s{0,}/)?`(${n})()`:n,r=`let {$cur, $el, $st, $fn, ${e}, ${s}, $body} = ops;return ${o}`,l=i?.split?.(c)?.map?.((t=>t.trim()))||["value"]||[],a=Array.from(new Set([...n?.matchAll(/\$st\.(\w{1,})/g)].map((t=>t[1]))));return o?{func:new Function("ops",r),as:l,dependencyList:a}:{}}catch(t){return console.error(t),{}}};function d(t,e,s){e?.preventDefault?.();let n=t?.S("pushstate"),i=s;switch(n){case"":break;case void 0:return;default:i=`#${n}`}history.pushState(null,"",i)}let $=new Map;class m{o;A=new Map;F=new Set;T;constructor(t){let e;return e=t.element?t.element:t.query?(t.parent||document).querySelector(t.query):document.createElement(t.create||"TEMPLATE"),this.o=e,$.get(this.o)?.D(),$.set(this.o,this),this.C(["_mfld",...t.classes||[]]),t.i&&t.i.ref.i(e,t.i.mode,!1),this.T=t.ops,this}S(t,e){e&&this.o?.setAttribute(`${u}${t}`,e);let s=this.o?.getAttribute(`${u}${t}`);return s??null}C(t,e=!1){for(let s of t)this.o?.classList[e?"remove":"add"]?.(s)}k(t,e=!0){return this.o?.["querySelector".concat(e?"All":"")](t)}q(s,n){let i=()=>n({$el:this.o,$st:e,$fn:t});this.o?.addEventListener(s,i),this.A?.set(s,i)}N(t){return t&&this.F?.add(t),t}P(s,n,i){let o=`${Date.now()}.${Math.floor(1e5*Math.random())}`;this.S("cstore",o),this.N(s);let r=f(o,{updater:()=>s?.({$el:this.o,$st:e,$fn:t}),dependencyList:n,scope:this});return i&&(this.N(i),r.sub(i)),r}i(t,e="append",s=!0){let n=s?t.cloneNode(!0):t;return this.o?.[e]?.(n),n}I(){this.o?.replaceChildren()}l(t){this.o?.replaceWith(t.o),this.D()}O(t=[]){if("TEMPLATE"==this.o?.tagName)return this.C(t),this;let e=new m({classes:t,ops:this.T,i:{ref:this}});return e.o.content?.append(this.o.cloneNode(!0)),this.l(e),e}H(){let t=this.o,e=getComputedStyle(t),s=t.getBoundingClientRect();return{w:`calc(${t.clientWidth}px - ${e.paddingLeft} - ${e.paddingRight})`,left:`calc(${s.left}px + ${window.scrollX}px)`,top:`calc(${s.top}px + ${window.scrollY}px)`}}t(t,e,s){o((()=>{"out"==t&&this.D()}))}D(){let t=this.o;this.A?.forEach(((e,s)=>{t?.removeEventListener(s,e)})),this.F?.forEach((t=>{this.F?.delete(t)})),this.k("._mfld",!0)?.forEach((t=>{$.get(t)?.D()})),t.remove(),this.F=this.A=t=null,t&&$.delete(t)}}let y=(t,e,s,n,i,o,r)=>{let l=e=>w(e,i,s,n,t,!0,o,r);"$mount"===e?l():t.q(e,l)},w=async(s,n,i,r,l,a,f,u)=>{s?.preventDefault(),s?.stopPropagation(),n||(n=s?.target?.method||"get");let c=i.fetch?.externals?.find((t=>"$origin"===t.domain&&(r.startsWith(location.origin)||!r.match(/^(https?):\/\//))||r.startsWith(t.domain)));c||(c=r.startsWith(location.origin)?{domain:"$origin",scripts:"selected",styles:"selected"}:void 0);let h=f?f({$el:l,$st:e,$fn:t}):void 0,$="$form"===h?new FormData(l.o):h,y=await fetch(r,{...i.fetch?.request||{},headers:{...i.fetch?.request?.headers,MFLD:"true"},method:n,body:"$form"===h||"string"==typeof $?$:JSON.stringify($)}).catch((t=>{i.fetch?.err?.(t)})),w=y?.status;if(w&&!1===i.fetch?.onCode?.(w,y))return;let _=await(y?.[i.fetch?.resType||"text"]());for(let t of["append","prepend","inner","outer"]){let e=l.S(t);if(!e)continue;let[s,n]=e.split("->").map((t=>t.trim())),r=(new DOMParser).parseFromString(_,"text/html"),f=new m({parent:r,query:s||"body",ops:i});if(r){let e=[];if(c?.styles&&"none"!==c.styles||r.querySelectorAll("style").forEach((t=>t.parentNode?.removeChild(t))),"all"===c?.styles&&r.querySelectorAll("style").forEach((t=>f?.i(t,"append",!1))),("all"===c?.scripts?r:f.o)?.querySelectorAll("script").forEach((t=>{["all","selected"].includes(c?.scripts||"")&&e.push(t),t.parentNode?.removeChild(t)})),f)if(a)o({in:f,out:n?new m({query:n,ops:i}):l,relation:t,ops:i,done:t=>{u?.(t);for(let s of e){let e=document.createElement("script");e.textContent=s.textContent,t?.i(e,"append",!1)}}});else{document.body.appendChild(f.o);for(let t of e){let e=document.createElement("script");for(let s of t.attributes)e.setAttribute(s.name,s.value);e.textContent=t.textContent,f.o.before(e)}}}}let g=l.S("resolve"),b=p(g||"")?.func;b?.({$el:l,$st:e,$fn:t,$body:_}),a&&d(l,s,r)},_=(t,e,s,n=!1)=>{let i=n?"previousElementSibling":"nextElementSibling";return!t||e?.(t)?t:_(s?.(t)||t?.[i],e,s,n)},g=(s,n,i,r,l,a)=>{let f,c=s.O([`${n}-end`]),h=new m({classes:[`${n}-start`],ops:a,i:{ref:c,mode:"before"}}),d=n.match(/if|else/),y=n.match(/else/),w=[];if(d){if(y){let t=_(h.o,(t=>t?.classList?.contains("if-end")),null,!0);_(t,(t=>t==c.o),(t=>{let e=t?.getAttribute(`${u}cstore`);e&&w.push(e)}))}f=c.N((()=>{if(y)for(let t of w)if(e[t])return!1;return"else"==n||!0===r?.({el:s,$st:e,$fn:t})}))}c.P(d?f:r,[...l,...w],(l=>{void 0!==l&&o((()=>{_(h.o.nextElementSibling,(t=>t?.classList?.contains(`${n}-end`)),(t=>{((t,e,s,n,i)=>{$.get(t)?$.get(t)?.t(e,n,i):new m({element:t,ops:s}).t(e,n,i)})(t,"out",a,r)})),d&&!l||((t,e)=>{if(t instanceof Map)for(let[s,n]of t.entries())e(n,s);else try{let s=Array.isArray(t)?t:Array.from(t);if(s.length)s.forEach(e);else for(let s in t)e(t[s],s)}catch(e){console.error(`${t} is not iterable`)}})("each"==n?l:[l],((n,o)=>{let r=c.o.cloneNode(!0);if(!d){let l=c.o.innerHTML.replace(/\$:{([^}]*)}/g,((r,l)=>p(l,i[0],i[1]).func?.({$el:s,$st:e,$fn:t,[i[0]]:n,[i[1]]:o})||""))||"";r.innerHTML&&(r.innerHTML=l)}for(let t of Array.from(r.content.children))t.innerHTML||(t.innerHTML=String(n)),c.i(t,"before"),new m({element:t,ops:a}).t("in")}))}))}))},b={},M=["bind","sync","templ","if","elseif","else","each","get","head","post","put","delete","patch","promote"];window.addEventListener("popstate",(()=>{location.reload()}));let v=(s,n=!1)=>{if(s?.nodeType==Node.TEXT_NODE)return;let i=":not(._mfld)",o=(s||document.body).querySelectorAll(`[${u}${M.join(`]${i},[${u}`)}]${i}`);for(let i of[s,...o].map((t=>new m({element:t,ops:b})))){let s=h(structuredClone(b),i);if(n)return;for(let n of M)if(null!==i.S(n))if("promote"!=n)for(let o of i.S(n)?.split(";;")||[""]){let r=!!/get|head|post|put|delete|patch/.test(n),l=o?.split(/\s*->\s*/g),a=r&&l.pop()||"",f=r||"sync"==n?l.shift()?.match(/[^\(\)]{1,}/g)?.pop()?.split(c)?.map((t=>t.trim()))||[]:null,h=l?.[0]||"",{func:$,as:m,dependencyList:w}=p(h);if(i.N($),f)for(let o of f)if("sync"==n){let s=s=>{$?.({$el:i.o,$st:e,$fn:t}),d(i,s)};"$mount"===o?s():i.q(o,s)}else y(i,o,s,a,n.replace(u,""),$);else"bind"==n?i.P($,w):g(i,n,m||[],$,w||[],s)}else{let[t,e,n,o]="A"==i.o.tagName?["get",i.o.href,void 0,"click"]:[i.o.method?.toLowerCase(),i.o.action,()=>"$form","submit"];e&&y(i,o,s,e,t,n,(t=>v(t)))}}},L={store:(t,e)=>(e?.hasOwnProperty("value")||e?.hasOwnProperty("updater")||(e={value:e}),f(t,e)),ustore:(t,e)=>f(t,e),funcs:t=>{for(let e in t)MFLD.$fn[e]=t[e]},config:(t,e)=>{return s=t,void((n=e)?b.profiles={...b.profiles,[n]:s}:b={...b,...s});var s,n},onTick:t=>{var e;(e=t)&&i.push(e)},register:t=>v("string"==typeof t?document.querySelector(t):t),makeComponent:(t,e)=>{MFLD.comp[t]=class extends HTMLElement{template=null;onconnect;onadopted;ondisconnect;onAttributeChanged;constructor(){super(),e?.onconstruct?.bind(this)?.(),this.onconnect=e?.onconnect?.bind(this),this.onadopted=e?.onadopted?.bind(this),this.ondisconnect=e?.ondisconnect?.bind(this),this.onAttributeChanged=e?.onAttributeChanged?.bind(this),this.template=new m({ops:e?.options||{},element:e?.templ||document.getElementById(e?.selector||t)})}connectedCallback(){let t=this.attachShadow({mode:e?.shadow||"closed"}),s=(this.template?.o).content.cloneNode(!0);if(s){t.append(s);for(let e of Array.from(t.children))if("SLOT"==e.nodeName)for(let t of e.assignedNodes())v(t);else"TEMPLATE"!=e.nodeName&&v(e)}}attributeChangedCallback(t,e,s){this.onAttributeChanged?.(t,e,s)}disconnectedCallback(){this.ondisconnect?.()}adoptedCallback(){this.onadopted?.()}static get observedAttributes(){return e?.observedAttributes||[]}},MFLD.comp[t]&&customElements.define(t,MFLD.comp[t])},component:async t=>{}},S=MFLD.$st,A=MFLD.$fn;export{A as $fn,S as $st,L as Mfld};
//# sourceMappingURL=dev.manifold.js.map
