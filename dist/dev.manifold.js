window.MFLD||(window.MFLD={st:new Map,mut:new Map,$st:new Proxy(f,{get:(t,e)=>"string"==typeof e?t(e)?.value:void 0,set:(t,e,s)=>{if("string"==typeof e){let n=e.split(/[\.\[\]\?]{1,}/g).map((t=>parseFloat(t.trim())||t.trim())),i=t(n[0]),o=i.value;for(let t of n.slice(1)||[])o=o[t];o=s,i.update(o)}return!0}}),$fn:{},comp:{}});let{$fn:t,$st:e}=MFLD,s=[],n=0,i=[],o=t=>{s.push(t),n||(n=requestAnimationFrame(r))},r=()=>{n=0;for(let t of s)"function"!=typeof t||t();i.forEach((t=>t())),i=[],s=[]};function l(t){if(!t||!isNaN(t)||!0===t)return t;if(t instanceof Map||t instanceof Set)return l(Array.from(t.entries()||t));let e=0;for(let s of(new TextEncoder).encode(t?.toString()||""))e=(e<<5)-e+s;return e}class a{t;i=new Set;o;l=new Set;h=new Set;u;p;name;value;constructor(t,e){this.name=t,MFLD.st.set(t,this),this.u=e?.scope,this.value="function"!=typeof e?.value?e?.value:void 0,this.$(e)}$(t){return t?.dependencyList?.map((t=>{let e=f(t);return this.l.add(e),e.h.add(this),e})),this.value=t?.value,this.t=t?.updater,this.m(),this}sub(t,e=!0){this.i.add(t),e&&t(this.value)}update(t){this.p&&clearTimeout(this.p),this.p=setTimeout((()=>{o((()=>{let e="function"==typeof t?t(this.value):t,s=l(e);if(s!==this.o){this.value=e,this.o=s.toString();for(let t of this.h)t.m();for(let t of Array.from(this.i))t(this.value)}return this.value}))}),0)}m(){let s=this.t?.({$cur:this.value,$st:e,$fn:t,$el:this.u?._});this.update(void 0===s?this.value:s)}}function f(t,e){let s=MFLD.st.get(t);return e?s?s.$(e):new a(t,e):s||new a(t,e)}let c="data-mf-",h=/, {0,}/g,u=(t,e)=>{let s=t.profiles?.[e.T("override")||""],n={...t,...s};for(let t of e._?.attributes||[])for(let e of["fetch","trans"]){let s=t.name;if(s.startsWith(`${c}${e}_`))try{let i=s.split("_")[2],o=t.value;o?.match(/\{|\[/)?o=JSON.parse(o):parseInt(o||"")&&(o=parseInt(o)),Array.isArray(o)&&(o=o.map((t=>parseInt(t)||t))),n?.[e]?.[i]&&(n[e][i]=o)}catch(t){console.error(t)}}return n},d=(t,e="$val",s="$key")=>{try{let[n,i]=t?.split(/\s{1,}as\s{1,}/)||[t,"value"],o=n?.match(/^\s{0,}(function)?\(.{0,}\)(=>)?\s{0,}/)?`(${n})()`:n,r=`let {$cur, $el, $st, $fn, ${e}, ${s}, $body} = ops;return ${o}`,l=i?.split?.(h)?.map?.((t=>t.trim()))||["value"]||[],a=Array.from(new Set([...n?.matchAll(/\$st\.(\w{1,})/g)].map((t=>t[1]))));return o?{func:new Function("ops",r),as:l,dependencyList:a}:{}}catch(t){return console.error(t),{}}};function p(t,e,s){e?.preventDefault?.();let n=t?.T("pushstate"),i=s;switch(n){case"":break;case void 0:return;default:i=`#${n}`}history.pushState(null,"",i)}let $=new Map,m=(t,e,s,n,i)=>{console.log("TRANSITIONING",e),($.get(t)||new y("TRANSITION "+e,{element:t,ops:s}))?.L(e,n,i)};class y{_;M=new Map;A=new Set;N;constructor(t,e){let s;return s=e.element?e.element:e.query?(e.parent||document).querySelector(e.query):document.createElement(e.create||"TEMPLATE"),this._=s,$.get(this._)?.v(!1),$.set(this._,this),console.log("CREATING regel from",t,this._,$.get(this._),$.size),this.S(["_mfld",...e.classes||[]]),e.F&&e.F.ref.F(s,e.F.mode,!1),this.N=e.ops,this}T(t,e){e&&this._?.setAttribute(`${c}${t}`,e);let s=this._?.getAttribute(`${c}${t}`);return s??null}S(t,e=!1){for(let s of t)this._?.classList[e?"remove":"add"]?.(s)}C(t,e=!0){return this._?.["querySelector".concat(e?"All":"")](t)}D(s,n){let i=()=>n({$el:this._,$st:e,$fn:t});this._?.addEventListener(s,i),this.M?.set(s,i)}I(t){return t&&this.A?.add(t),t}O(s,n,i){let o=`${Date.now()}.${Math.floor(1e5*Math.random())}`;this.T("cstore",o),this.I(s);let r=f(o,{updater:()=>s?.({$el:this._,$st:e,$fn:t}),dependencyList:n,scope:this});return i&&(this.I(i),r.sub(i)),r}F(t,e="append",s=!0){let n=s?t.cloneNode(!0):t;return this._?.[e]?.(n),n}k(t){this._?.replaceWith(t._),this.v()}P(t=[]){if("TEMPLATE"==this._?.tagName)return this.S(t),this;let e=new y("As TeMPL",{classes:t,ops:this.N,F:{ref:this}});return e._.content?.append(this._.cloneNode(!0)),this.k(e),e}H(){let t=this._,e=getComputedStyle(t),s=t.getBoundingClientRect();return{w:`calc(${t.clientWidth}px - ${e.paddingLeft} - ${e.paddingRight})`,left:`calc(${s.left}px + ${window.scrollX}px)`,top:`calc(${s.top}px + ${window.scrollY}px)`}}L(t,e,s){o((()=>{"out"==t&&(console.log("OUT",this._),this.v()),s?.()}))}v(t=!0){console.log("CLEANING",this._,$.get(this._),$.size-1),this.M?.forEach(((t,e)=>{this._?.removeEventListener(e,t)})),this.A?.forEach((t=>{this.A?.delete(t)})),this.C("._mfld",!0)?.forEach((t=>{$.get(t)?.v()})),this.A=this.M=null,t&&this._.remove(),$.delete(this._)}}window.reg=$;let w=(t,e,s,n,i,o,r)=>{console.log("HANDLING FETCH");let l=e=>_(e,i,s,n,t,!0,o,r);"$mount"===e?l():t.D(e,l)},_=async(s,n,i,o,r,l,a,f)=>{s?.preventDefault(),s?.stopPropagation(),n||(n=s?.target?.method||"get");let c=i.fetch?.externals?.find((t=>"$origin"===t.domain&&(o.startsWith(location.origin)||!o.match(/^(https?):\/\//))||o.startsWith(t.domain)));c||(c=o.startsWith(location.origin)?{domain:"$origin",script:"selected",style:"selected"}:void 0);let h=a?a({$el:r,$st:e,$fn:t}):void 0,u="$form"===h?new FormData(r._):h,$=await fetch(o,{...i.fetch?.request||{},headers:{...i.fetch?.request?.headers,MFLD:"true"},method:n,body:"$form"===h||"string"==typeof u?u:JSON.stringify(u)}).catch((t=>{i.fetch?.err?.(t)})),m=$?.status;if(m&&!1===i.fetch?.onCode?.(m,$))return;let w=await($?.[i.fetch?.resType||"text"]());for(let t of["append","prepend","inner","outer"]){let e=r.T(t);if(null==e)continue;let[s,n]=e.split("->").map((t=>t.trim())),o=(new DOMParser).parseFromString(w,"text/html"),l=new y("FETCH IN EL",{parent:o,query:s||"body",ops:i}),[a,h]=["style","script"].map((t=>Array.from(("all"==c?.[t]?o:l._)?.querySelectorAll(t))));if("all"===c?.style)a.forEach((t=>l?.F(t,"append",!1)));else a.forEach((t=>t.parentNode?.removeChild(t)));for(let t of h)t.parentNode?.removeChild(t);l&&l.L("in",null,(()=>{f?.(r);for(let t of h){let e=document.createElement("script");e.textContent=t.textContent,r?._?.append(e)}})),(n?new y("FETCH OUTEL",{query:n,ops:i}):r).L("out")}let _=r.T("resolve"),T=d(_||"")?.func;T?.({$el:r,$st:e,$fn:t,$body:w}),l&&p(r,s,o)},T=(t,e,s,n=!1)=>{let i=n?"previousElementSibling":"nextElementSibling";return!t||e?.(t)?t:T(s?.(t)||t?.[i],e,s,n)},g=(s,n,i,r,l,a)=>{let f,h=s.P([`${n}-end`]),u=document.createElement("template"),p=n.match(/if|else/),$=n.match(/else/),y=[];if(u.classList.add(`${n}-start`),h.F(u,"before"),console.log("RUNNING TEMPL HANDLER"),p){if($){let t=T(u,(t=>t?.classList?.contains("if-end")),null,!0);T(t,(t=>t==h._),(t=>{let e=t?.getAttribute(`${c}cstore`);e&&y.push(e)}))}f=h.I((()=>{if($)for(let t of y)if(e[t])return!1;return"else"==n||!0===r?.({el:s,$st:e,$fn:t})}))}h.O(p?f:r,[...l,...y],(l=>{void 0!==l&&o((()=>{T(u.nextElementSibling,(t=>t?.classList?.contains(`${n}-end`)),(t=>{m(t,"out",a,r)})),o((()=>{p&&!l||((t,e)=>{if(t instanceof Map)for(let[s,n]of t.entries())e(n,s);else try{let s=Array.isArray(t)?t:Array.from(t);if(s.length)s.forEach(e);else for(let s in t)e(t[s],s)}catch(e){console.error(`${t} is not iterable`)}})("each"==n?l:[l],((n,o)=>{let r=h._.cloneNode(!0);if(!p){let l=h._.innerHTML.replace(/\$:{([^}]*)}/g,((r,l)=>d(l,i[0],i[1]).func?.({$el:s,$st:e,$fn:t,[i[0]]:n,[i[1]]:o})||""))||"";r.innerHTML&&(r.innerHTML=l)}for(let t of Array.from(r.content.children))t.innerHTML||(t.innerHTML=String(n)),h.F(t,"before"),m(t,"in",a)}))}))}))}))},L={},M=["bind","sync","templ","if","elseif","else","each","get","head","post","put","delete","patch","promote"];window.addEventListener("popstate",(()=>{location.reload()}));let E=(s,n=!1)=>{if(!s||s?.nodeType==Node.TEXT_NODE)return;let i=":not(._mfld)",o=s.querySelectorAll(`[${c}${M.join(`]${i},[${c}`)}]${i}`);for(let i of(n?[...o]:[s,...o]).map((t=>((t,e)=>$.get(t)||new y("REGISTER ELEMENT FN",{element:t,ops:e}))(t,L)))){let s=u(structuredClone(L),i);for(let n of M)if(null!==i.T(n))if("promote"!=n)for(let o of i.T(n)?.split(";;")||[""]){let r=!!/get|head|post|put|delete|patch/.test(n),l=o?.split(/\s*->\s*/g),a=r&&l.pop()||"",f=r||"sync"==n?l.shift()?.match(/[^\(\)]{1,}/g)?.pop()?.split(h)?.map((t=>t.trim()))||[]:null,u=l?.[0]||"",{func:$,as:m,dependencyList:y}=d(u);if(i.I($),f)for(let o of f)if("sync"==n){let s=s=>{$?.({$el:i._,$st:e,$fn:t}),p(i,s)};"$mount"===o?s():i.D(o,s)}else w(i,o,s,a,n.replace(c,""),$);else"bind"==n?i.O($,y):g(i,n,m||[],$,y||[],s)}else{let[t,e,n,o]="A"==i._.tagName?["get",i._.href,void 0,"click"]:[i._.method?.toLowerCase(),i._.action,()=>"$form","submit"];e&&w(i,o,s,e,t,n,(t=>E(t)))}}},b={store:(t,e)=>(e?.hasOwnProperty("value")||e?.hasOwnProperty("updater")||(e={value:e}),f(t,e)),ustore:(t,e)=>f(t,e),funcs:t=>{for(let e in t)MFLD.$fn[e]=t[e]},config:(t,e)=>{return s=t,void((n=e)?L.profiles={...L.profiles,[n]:s}:L={...L,...s});var s,n},onTick:t=>{var e;(e=t)&&i.push(e)},register:t=>E("string"==typeof t?document.querySelector(t):t),makeComponent:(t,e)=>{MFLD.comp[t]=class extends HTMLElement{template=null;onconnect;onadopted;ondisconnect;onAttributeChanged;constructor(){super(),e?.onconstruct?.bind(this)?.(),this.onconnect=e?.onconnect?.bind(this),this.onadopted=e?.onadopted?.bind(this),this.ondisconnect=e?.ondisconnect?.bind(this),this.onAttributeChanged=e?.onAttributeChanged?.bind(this),this.template=new y("COMPONENT",{ops:e?.options||{},element:e?.templ||document.getElementById(e?.selector||t)})}connectedCallback(){let t=this.attachShadow({mode:e?.shadow||"closed"}),s=(this.template?._).content.cloneNode(!0);if(s){t.append(s);for(let e of Array.from(t.children))if("SLOT"==e.nodeName)for(let t of e.assignedNodes())E(t);else"TEMPLATE"!=e.nodeName&&E(e)}}attributeChangedCallback(t,e,s){this.onAttributeChanged?.(t,e,s)}disconnectedCallback(){this.ondisconnect?.()}adoptedCallback(){this.onadopted?.()}static get observedAttributes(){return e?.observedAttributes||[]}},MFLD.comp[t]&&customElements.define(t,MFLD.comp[t])},component:async t=>{}},A=MFLD.$st,N=MFLD.$fn;export{N as $fn,A as $st,b as Mfld};
//# sourceMappingURL=dev.manifold.js.map
