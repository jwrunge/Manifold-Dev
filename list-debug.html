<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>List Debug Test</title>
		<style>
			body {
				font-family: system-ui, -apple-system, sans-serif;
				max-width: 600px;
				margin: 0 auto;
				padding: 2rem;
				line-height: 1.6;
			}

			.section {
				background: #f5f5f5;
				padding: 1rem;
				margin: 1rem 0;
				border-radius: 4px;
				border-left: 4px solid #007acc;
			}

			button {
				background: #007acc;
				color: white;
				border: none;
				padding: 0.5rem 1rem;
				border-radius: 4px;
				cursor: pointer;
				margin: 0.5rem 0.5rem 0.5rem 0;
			}

			.item {
				background: white;
				padding: 0.5rem;
				margin: 0.25rem 0;
				border-radius: 4px;
				border: 1px solid #ddd;
			}
		</style>
	</head>
	<body>
		<h1>List Rendering Debug</h1>

		<div class="section">
			<h3>Debug Info</h3>
			<div id="debug"></div>
		</div>

		<div class="section">
			<h3>Simple List Test</h3>
			<div data-each="@testItems">
				<div class="item">Item ${key}: ${value}</div>
			</div>
			<button onclick="addTestItem()">Add Test Item</button>
			<button onclick="logState()">Log State</button>
		</div>

		<script type="module">
			import Manifold from "./src/index.js";

			console.log("=== MANIFOLD DEBUG ===");
			console.log("Manifold object:", Manifold);

			// Create test data BEFORE initialization - ADD TO GLOBAL STATE
			Manifold.$.testItems = Manifold.$.create([
				"Apple",
				"Banana",
				"Cherry",
			]);

			console.log("Created testItems state:", Manifold.$.testItems);
			console.log("testItems initial value:", Manifold.$.testItems.value);
			console.log("Global state:", Manifold.$);

			// Global functions
			window.addTestItem = function () {
				const items = [...Manifold.$.testItems.value];
				items.push(`Item ${items.length + 1}`);
				Manifold.$.testItems.value = items;
				console.log("Updated testItems:", Manifold.$.testItems.value);
			};

			window.logState = function () {
				console.log("Current testItems:", Manifold.$.testItems.value);
				console.log(
					"Is array?",
					Array.isArray(Manifold.$.testItems.value)
				);
			};

			// Initialize and debug
			console.log("=== INITIALIZATION ===");
			try {
				Manifold.init();
				console.log("Manifold initialized successfully");

				// Update debug info
				document.getElementById("debug").innerHTML = `
                <p>Initial testItems: ${JSON.stringify(
					Manifold.$.testItems.value
				)}</p>
                <p>Length: ${Manifold.$.testItems.value.length}</p>
                <p>Type: ${typeof Manifold.$.testItems.value}</p>
                <p>Is Array: ${Array.isArray(Manifold.$.testItems.value)}</p>
            `;
			} catch (error) {
				console.error("Error initializing Manifold:", error);
				document.getElementById(
					"debug"
				).innerHTML = `<p style="color:red">Error: ${error.message}</p>`;
			}
		</script>
	</body>
</html>
